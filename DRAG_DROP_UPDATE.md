# עדכון: הוספת Drag & Drop לשיבוץ חי ומחיקת דף שיבוצים רגיל

## שינויים שבוצעו

### 1. הוספת Drag & Drop לשיבוץ חי (2D)
- הוספת ספריות `@dnd-kit` ל-`package.json`
- עדכון `LiveSchedule.jsx` עם פונקציונליות גרירה והזזה דו-ממדית
- **משימות** עכשיו ניתנות לגרירה:
  - **אנכית** - בין שעות שונות (למעלה/למטה)
  - **אופקית** - בין תבניות שונות (ימינה/שמאלה)
- **עמודות (כותרות תבניות)** עכשיו ניתנות לגרירה:
  - גרור כותרת עמודה כדי לשנות את סדר העמודות
  - הסדר נשמר במהלך הסשן
- הוספת אייקון "Move" שמופיע כש-hover על משימה ועל כותרת עמודה
- אנימציה ויזואלית בזמן גרירה
- הודעות מותאמות לסוג השינוי

### 2. מחיקת דף שיבוצים רגיל
- נמחקו הקבצים: `Shavzakim.jsx` ו-`ShavzakView.jsx`
- הוסר הניתוב מ-`App.jsx`
- הוסר הלינק מהתפריט הצדדי ב-`Layout.jsx`

### 3. Backend
- הוספת endpoint חדש: `PATCH /api/assignments/<id>/time`
- עדכון מהיר של:
  - שעת התחלה (`start_hour`)
  - שם התבנית/משימה (`name`)
  - או שניהם ביחד
- בדיקות תקינות מלאות

## התקנה

### שלב 1: התקן ספריות חדשות

```bash
cd front
npm install
```

זה יתקין את הספריות הבאות:
- `@dnd-kit/core@^6.1.0`
- `@dnd-kit/sortable@^8.0.0`
- `@dnd-kit/utilities@^3.2.2`

### שלב 2: הפעל מחדש את השרת

**Backend:**
```bash
cd back
python api.py
```

**Frontend:**
```bash
cd front
npm run dev
```

## שימוש

1. היכנס ל**שיבוץ חי** מהתפריט הצדדי
2. הצג משימה כלשהי בלוח השעות

### גרירת משימות (רק מפקדים - מפ/ממ):
3. **גרור משימה**:
   - **למעלה/למטה** - לשנות את השעה
   - **ימינה/שמאלה** - לשנות את סוג המשימה/תבנית
   - **באלכסון** - לשנות גם שעה וגם תבנית
4. המשימה תתעדכן אוטומטית בשרת
5. תקבל הודעה על ההצלחה (מותאמת לסוג השינוי)

### גרירת עמודות (רק מפקדים - מפ/ממ):
6. **גרור כותרת עמודה** (שם התבנית):
   - לחץ על כותרת העמודה והחזק
   - גרור ימינה או שמאלה כדי לשנות את מיקומה
   - השחרר כדי לעדכן את הסדר
7. הסדר החדש נשמר למשך הסשן (עד לרענון הדף)

## הערות טכניות

- רק משתמשים עם תפקיד **מפ** או **ממ** יכולים לגרור משימות ועמודות
- **גרירה דו-ממדית מלאה**: אפשר לגרור למעלה/למטה (שעות) וימינה/שמאלה (תבניות)
- **גרירת עמודות**: משתמש ב-`@dnd-kit/sortable` עם `horizontalListSortingStrategy`
  - סדר העמודות נשמר ב-state מקומי (`columnOrder`)
  - הסדר מתאפס כאשר טוענים יום חדש או מרעננים את הדף
- השרת בודק (בעת גרירת משימות):
  - שעה חדשה היא בין 0-23
  - שם תבנית לא ריק
- הודעות אפשריות:
  - **גרירת משימה**:
    - "המשימה הועברה לשעה XX:00" (רק שעה)
    - "המשימה שונתה ל-[שם]" (רק תבנית)
    - "המשימה הועברה ל-[שם] בשעה XX:00" (שניהם)
  - **גרירת עמודה**: "סדר העמודות עודכן"
- אם הגרירה נכשלת, המשימה/עמודה תחזור למקומה המקורי

## פתרון בעיות

### הספריות לא מותקנות
```bash
cd front
rm -rf node_modules package-lock.json
npm install
```

### שגיאת TypeScript/ESLint
הספריות `@dnd-kit` כתובות ב-TypeScript אבל תומכות ב-JavaScript. אם יש שגיאות, נסה:
```bash
npm install --legacy-peer-deps
```

### המשימות לא זזות
- ודא שאתה מחובר כמפ או ממ
- בדוק שהשרת רץ ועובד
- פתח את Console בדפדפן וחפש שגיאות
