# ğŸ–ï¸ Shavzak Backend - ××¢×¨×›×ª ×©×™×‘×•×¥ ×—×›××” ×¢× AI

××¢×¨×›×ª API ××ª×§×“××ª ×œ× ×™×”×•×œ ×©×™×‘×•×¦×™× ×¦×‘××™×™× ×”××©×œ×‘×ª **×œ××™×“×ª ××›×•× ×” (Machine Learning)** ×œ×©×™×‘×•×¥ ×—×›× ×•××•×˜×•××˜×™.

×”××¢×¨×›×ª ×œ×•××“×ª ××“×•×’×××•×ª ×©×™×‘×•×¥ ×§×™×™××•×ª ×•××©×ª×¤×¨×ª ×¢× ×›×œ ×¤×™×“×‘×§ ××”××©×ª××©! ğŸ¤–

---

## ğŸ“– ×”× ×—×™×•×ª AI

**×—×©×•×‘!** ×”××¢×¨×›×ª ×¤×•×¢×œ×ª ×œ×¤×™ 5 ×›×œ×œ×™× ××¨×›×–×™×™× ×©××•×’×“×¨×™× ×‘×§×•×‘×¥:
### **[ğŸ“‹ AI_GUIDELINES.md](./AI_GUIDELINES.md) - ×”× ×—×™×•×ª ××œ××•×ª ×œ××¢×¨×›×ª AI**

×”×›×œ×œ×™× ×”××¨×›×–×™×™×:
1. ğŸ”„ **×¨×•×˜×¦×™×” ×œ×¤×™ ××—×œ×§×•×ª** - ×©×™×‘×•×¥ ××—×œ×§×ª×™ ×¢× ×¨×•×˜×¦×™×” ×”×•×’× ×ª (1â†’2â†’3â†’4)
2. ğŸ˜´ **××§×¡×™××•× ×©×¢×•×ª ×× ×•×—×”** - ×¢×“×™×¤×•×ª ×œ××™ ×©× ×— ×”×›×™ ×”×¨×‘×”
3. ğŸ”’ **××™×œ×•×¦×™× ×›×œ×œ ×‘×¨×–×œ** - ××¡×•×¨ ×œ×”×¤×¨ (×–××™× ×•×ª, ×× ×•×—×”, ×”×¡××›×•×ª)
4. âš¡ **×¤×™×“×‘×§ ××™×™×“×™** - ×©×™× ×•×™ ××™×™×“×™ ×‘×©×™×‘×•×¥ + ×œ××™×“×” ××”×¤×™×“×‘×§
5. âœ… **××£ ×¤×¢× ×œ× × ×›×©×œ** - ×ª××™×“ ×œ××¦×•× ×¤×ª×¨×•×Ÿ (Fallback ×‘×©×›×‘×•×ª)

**×§×¨× ××ª ×”××¡××š ×”××œ× ×œ×¤× ×™ ×¢×‘×•×“×” ×¢×œ ×”××¢×¨×›×ª!**

---

## ğŸš€ ×ª×›×•× ×•×ª ×¢×™×§×¨×™×•×ª

### ğŸ§  ×©×™×‘×•×¥ ×—×›× ×¢× AI
- **××œ×’×•×¨×™×ª× ML** ×©×œ×•××“ ×-20+ ×“×•×’×××•×ª ×©×™×‘×•×¥
- **××©×ª×¤×¨ ××•×˜×•××˜×™×ª** ×¢× ×¤×™×“×‘×§ ××”××©×ª××©
- **× ×™×§×•×“ ×—×™×™×œ×™×** ×œ×¤×™ ×× ×•×—×”, ×¢×•××¡, ×•×“×¤×•×¡×™× ×©× ×œ××“×•
- **×¨×•×˜×¦×™×” ×”×•×’× ×ª** ×‘×™×Ÿ ××—×œ×§×•×ª

### âœ… ××™×œ×•×¦×™× ×§×©×™×—×™×
- ×× ×•×—×” ××™× ×™××œ×™×ª (8 ×©×¢×•×ª)
- ×‘×“×™×§×ª ×–××™× ×•×ª (×—×•×¤×©×•×ª, ×¨×™×ª×•×§, ×”×ª×©"×‘)
- ×“×¨×™×©×•×ª ×”×¡××›×” (× ×”×’, ×—××œ, ×•×›×•')
- ×× ×™×¢×ª ×—×¤×™×¤×•×ª

### ğŸ“Š ×œ××™×“×” ××ª××©×›×ª
- ××™××•×Ÿ ××“×•×’×××•×ª ×©×™×‘×•×¥ ×˜×•×‘×•×ª
- ×©××™×¨×ª ×“×¤×•×¡×™× ×©× ×œ××“×•
- ××¢×§×‘ ××—×¨×™ ×”×¦×œ×—×•×ª/×›×™×©×œ×•× ×™×
- ×¡×˜×˜×™×¡×˜×™×§×•×ª ×‘×™×¦×•×¢×™× ×‘×–××Ÿ ×××ª

### ğŸ¯ ×ª×›×•× ×•×ª × ×•×¡×¤×•×ª
- API RESTful ××œ× (40+ endpoints)
- ××¢×¨×›×ª ×”×¨×©××•×ª (××¤/××/××›)
- JWT Authentication
- SQLite Database
- × ×™×”×•×œ ×–××™× ×•×ª ××ª×§×“×

---

## âš¡ ×”×ª×§× ×” ×•×”×¤×¢×œ×”

### ×“×¨×™×©×•×ª ××§×“×™××•×ª
```bash
Python >= 3.8
pip
numpy, scikit-learn (×™×•×ª×§×Ÿ ××•×˜×•××˜×™×ª)
```

### ×”×ª×§× ×”
```bash
cd back
pip install -r requirements.txt
python setup.py  # ×™×¦×™×¨×ª ××¡×“ × ×ª×•× ×™×
```

### ×”×¤×¢×œ×”
```bash
python api.py
```

×”×©×¨×ª ×™×¢×œ×” ×¢×œ: `http://localhost:5000`

××ª×” ×ª×¨××”:
```
âœ… Smart Scheduler: ××•×“×œ × ×˜×¢×Ÿ ×-ml_model.pkl
××•
âš ï¸ Smart Scheduler: ××™×Ÿ ××•×“×œ ×§×™×™× - ×™×© ×œ×××Ÿ ×ª×—×™×œ×”
```

---

## ğŸ§  ××¢×¨×›×ª ML - ××™×š ×–×” ×¢×•×‘×“?

### 1. **××™×œ×•×¦×™× ×§×©×™×—×™× (Hard Constraints)**
×“×‘×¨×™× ×©××¡×•×¨ ×œ×”×¤×¨:
```
âœ… ×× ×•×—×” ××™× ×™××œ×™×ª
âœ… ××™-×–××™× ×•×ª (×—×•×¤×©×•×ª, ×”×ª×©"×‘, ×¨×™×ª×•×§)
âœ… ×”×¡××›×•×ª × ×“×¨×©×•×ª
âœ… ×œ×œ× ×—×¤×™×¤×•×ª ×‘×–××Ÿ
```

### 2. **×”×¢×“×¤×•×ª ×¨×›×•×ª (Soft Preferences) - ML**
×”××•×“×œ ×œ×•××“:
```
ğŸ¯ ××™ ×©× ×— ×™×•×ª×¨ ××§×‘×œ ×¢×“×™×¤×•×ª
ğŸ¯ ×¨×•×˜×¦×™×” ×”×•×’× ×ª ×‘×™×Ÿ ××—×œ×§×•×ª
ğŸ¯ ×“×¤×•×¡×™× (××™×–×” ×—×™×™×œ×™× ×˜×•×‘×™× ×œ××©×™××”)
ğŸ¯ ×¤×™×“×‘×§ ××”××©×ª××© (ğŸ‘ / ğŸ‘)
```

### 3. **× ×™×§×•×“ ×—×™×™×œ×™×**
×›×œ ×—×™×™×œ ××§×‘×œ ×¦×™×•×Ÿ ×œ××©×™××” ×œ×¤×™:

```python
score = (
    rest_hours * 2.0 +        # ×× ×•×—×”
    -workload * 1.5 +          # ×¢×•××¡
    pattern_score * 3.0 +      # ×“×¤×•×¡×™× ×©× ×œ××“×•
    -mahlaka_work * 0.5 +      # ×¢×•××¡ ××—×œ×§×”
    feedback_score * 4.0       # ×¤×™×“×‘×§ ××©×ª××© â­
)
```

**×”×¦×™×•×Ÿ ×”×’×‘×•×” ×‘×™×•×ª×¨ × ×‘×—×¨ ×œ××©×™××”!**

---

## ğŸ”Œ API Endpoints ×”×—×“×©×™×

### `POST /api/ml/smart-schedule`
×™×¦×™×¨×ª ×©×™×‘×•×¥ ×—×›× ×¢× ML

**Request:**
```json
{
  "pluga_id": 1,
  "start_date": "2025-01-01",
  "days_count": 7
}
```

**Response:**
```json
{
  "message": "× ×•×¦×¨×• 42 ××©×™××•×ª ×‘×”×¦×œ×—×”",
  "assignments": [...],
  "stats": {
    "total_assignments": 42,
    "approval_rate": 85.5,
    "patterns_learned": 47
  }
}
```

### `POST /api/ml/train`
××™××•×Ÿ ×”××•×“×œ ××“×•×’×××•×ª

**Request:**
```json
{
  "examples": [
    {
      "assignments": [
        {
          "type": "×¡×™×•×¨",
          "soldiers": [1, 2, 3, 4],
          "day": 0,
          "start_hour": 8
        }
      ],
      "rating": "excellent"  // ××• "good" / "bad"
    }
  ]
}
```

### `POST /api/ml/feedback`
×”×•×¡×¤×ª ×¤×™×“×‘×§ ×¢×œ ×©×™×‘×•×¥

**Request:**
```json
{
  "assignment_id": 123,
  "rating": "approved",  // ××• "rejected" / "modified"
  "changes": {}
}
```

### `GET /api/ml/stats`
×§×‘×œ×ª ×¡×˜×˜×™×¡×˜×™×§×•×ª ML

**Response:**
```json
{
  "stats": {
    "total_assignments": 150,
    "user_approvals": 128,
    "user_rejections": 14,
    "approval_rate": 85.3,
    "patterns_learned": 47,
    "feedback_count": 142
  }
}
```

### `POST /api/ml/upload-example`
×”×¢×œ××ª ×“×•×’××ª ×©×™×‘×•×¥ ××ª××•× ×”

**Request:**
```json
{
  "image": "base64_encoded_image",
  "rating": "excellent"
}
```

---

## ğŸ“š ××“×¨×™×š ×©×™××•×© ××œ×

### ×©×œ×‘ 1: ×”×§××ª ××¢×¨×›×ª
```bash
# 1. ×”×¨×©××” ×›××¤×§×“
curl -X POST http://localhost:5000/api/register \
  -H "Content-Type: application/json" \
  -d '{"username":"commander1","password":"pass123","full_name":"××©×” ×›×”×Ÿ"}'

# 2. ×™×¦×™×¨×ª ×¤×œ×•×’×”
curl -X POST http://localhost:5000/api/plugot \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"name":"×¤×œ×•×’×” ×‘","gdud":"×’×“×•×“ ×¤× ×ª×¨"}'

# 3. ×™×¦×™×¨×ª ××—×œ×§×•×ª (4 ××—×œ×§×•×ª)
curl -X POST http://localhost:5000/api/mahalkot \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"number":1,"color":"#FF0000","pluga_id":1}'

# 4. ×”×•×¡×¤×ª ×—×™×™×œ×™×
curl -X POST http://localhost:5000/api/soldiers \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"name":"×“×•×“ ××‘×¨×”×","role":"×œ×•×—×","mahlaka_id":1,"kita":"×"}'
```

### ×©×œ×‘ 2: ×”×’×“×¨×ª ×ª×‘× ×™×•×ª ××©×™××•×ª
```bash
curl -X POST http://localhost:5000/api/plugot/1/assignment-templates \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name":"×¡×™×•×¨",
    "assignment_type":"×¡×™×•×¨",
    "length_in_hours":8,
    "times_per_day":3,
    "commanders_needed":1,
    "drivers_needed":1,
    "soldiers_needed":2,
    "same_mahlaka_required":true
  }'
```

### ×©×œ×‘ 3: ××™××•×Ÿ ×”××•×“×œ (××•×¤×¦×™×•× ×œ×™)
×× ×™×© ×œ×š ×“×•×’×××•×ª ×©×™×‘×•×¥ ×˜×•×‘×•×ª:

```bash
curl -X POST http://localhost:5000/api/ml/train \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "examples": [
      {
        "assignments": [...],
        "rating": "excellent"
      }
    ]
  }'
```

### ×©×œ×‘ 4: ×™×¦×™×¨×ª ×©×™×‘×•×¥ ×—×›×
```bash
curl -X POST http://localhost:5000/api/ml/smart-schedule \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "pluga_id": 1,
    "start_date": "2025-01-01",
    "days_count": 7
  }'
```

### ×©×œ×‘ 5: ××ª×Ÿ ×¤×™×“×‘×§ (×©×™×¤×•×¨ ×”××•×“×œ)
```bash
curl -X POST http://localhost:5000/api/ml/feedback \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "assignment_id": 123,
    "rating": "approved"
  }'
```

---

## ğŸ“ ××‘× ×” ×”×§×‘×¦×™×

```
back/
â”œâ”€â”€ api.py                    # Flask API server
â”œâ”€â”€ smart_scheduler.py        # ğŸ¤– ML Engine
â”œâ”€â”€ models.py                 # Database models
â”œâ”€â”€ auth.py                   # Authentication
â”œâ”€â”€ config.py                 # Configuration
â”œâ”€â”€ setup.py                  # DB setup
â”œâ”€â”€ ml_model.pkl             # ×”××•×“×œ ×”×©××•×¨ (× ×•×¦×¨ ××—×¨×™ ××™××•×Ÿ)
â”œâ”€â”€ assignment_logic.py.backup  # ×’×™×‘×•×™ ×œ×•×’×™×§×” ×™×©× ×”
â””â”€â”€ README.md                 # ×”××¡××š ×”×–×”
```

---

## ğŸ”§ ×§×•× ×¤×™×’×•×¨×¦×™×”

### ×”×’×“×¨×•×ª ML
× ×™×ª×Ÿ ×œ×©× ×•×ª ×‘-`smart_scheduler.py`:

```python
scheduler = SmartScheduler(
    min_rest_hours=8  # ×©×¢×•×ª ×× ×•×—×” ××™× ×™××œ×™×•×ª
)
```

### ×›×•×•× ×•×Ÿ ××©×§×•×œ×•×ª
× ×™×ª×Ÿ ×œ×›×•×•× ×Ÿ ××ª ×”××©×§×•×œ×•×ª ×‘-`calculate_soldier_score()`:

```python
score += rest_hours * 2.0       # ××©×§×œ ×× ×•×—×”
score -= workload * 1.5         # ××©×§×œ ×¢×•××¡
score += pattern_score * 3.0    # ××©×§×œ ×“×¤×•×¡×™×
score += feedback_score * 4.0   # ××©×§×œ ×¤×™×“×‘×§
```

**××©×§×œ ×’×‘×•×” ×™×•×ª×¨ = ×—×©×™×‘×•×ª ×¨×‘×” ×™×•×ª×¨**

---

## ğŸ“Š ×¡×˜×˜×™×¡×˜×™×§×•×ª ×•××¢×§×‘

×”××•×“×œ ×©×•××¨ ×•××¢×§×‘:
- âœ… ×›××•×ª ×©×™×‘×•×¦×™× ×©× ×•×¦×¨×•
- âœ… ××™×©×•×¨×™×/×“×—×™×•×ª ××”××©×ª××©
- âœ… ×“×™×¨×•×’ ×”×¦×œ×—×” (approval rate)
- âœ… ×“×¤×•×¡×™× ×©× ×œ××“×•
- âœ… ×”×™×¡×˜×•×¨×™×™×ª ×¤×™×“×‘×§

×’×™×©×” ×“×¨×š:
```bash
GET /api/ml/stats
```

---

## ğŸ› Debugging ×•×”×“×¨×›×”

### ×œ×•×’×™×
×”××¢×¨×›×ª ××“×¤×™×¡×” ×œ×•×’×™× ××¤×•×¨×˜×™×:

```
ğŸ–ï¸  Shavzak API Server Starting...
âœ… Smart Scheduler: ××•×“×œ × ×˜×¢×Ÿ ×-ml_model.pkl
ğŸ“Š 47 ×“×¤×•×¡×™× × ×œ××“×•
ğŸ“ ××××Ÿ ××•×“×œ ×-20 ×“×•×’×××•×ª...
âœ… ××™××•×Ÿ ×”×•×©×œ×!
```

### ×‘×“×™×§×ª ××•×“×œ (Python)
```python
from smart_scheduler import SmartScheduler

scheduler = SmartScheduler()
scheduler.load_model('ml_model.pkl')

# ×¡×˜×˜×™×¡×˜×™×§×•×ª
print(scheduler.get_stats())

# ×“×¤×•×¡×™× ×©× ×œ××“×•
print(scheduler.learned_patterns)

# ×”×™×¡×˜×•×¨×™×™×ª ×¤×™×“×‘×§
print(scheduler.user_feedback)
```

### ×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª × ×¤×•×¦×•×ª

**××•×“×œ ×œ× × ×˜×¢×Ÿ:**
```
âš ï¸ Smart Scheduler: ××™×Ÿ ××•×“×œ ×§×™×™×
```
**×¤×ª×¨×•×Ÿ:** ×××Ÿ ××ª ×”××•×“×œ ×“×¨×š `/api/ml/train`

**×¤×•×¨×˜ ×ª×¤×•×¡:**
```bash
lsof -ti:5000 | xargs kill -9  # Linux/Mac
```

**Token ×œ× ×¢×•×‘×“:**
- Token ×¤×’ ×ª×•×§×£ ××—×¨×™ 7 ×™××™×
- ×•×•×“× ×©×™×© "Bearer " ×‘×ª×—×™×œ×ª ×”-Token

---

## ğŸ¯ ×ª×¨×•××” ×œ×©×™×¤×•×¨ ×”××•×“×œ

×¨×•×¦×” ×œ×©×¤×¨ ××ª ×‘×™×¦×•×¢×™ ×”××•×“×œ?

1. **×”×•×¡×£ ×“×•×’×××•×ª ×˜×•×‘×•×ª** ×“×¨×š `/api/ml/train`
2. **×ª×Ÿ ×¤×™×“×‘×§** ×¢×œ ×›×œ ×©×™×‘×•×¥ ×“×¨×š `/api/ml/feedback`
3. **×›×•×•× ×Ÿ ××©×§×•×œ×•×ª** ×‘-`smart_scheduler.py`
4. **×‘×“×•×§ ×¡×˜×˜×™×¡×˜×™×§×•×ª** ×“×¨×š `/api/ml/stats`

**×›×›×œ ×©×”××¢×¨×›×ª ×ª×œ××“ ×™×•×ª×¨, ×”×™× ×ª×©×ª×¤×¨!** ğŸš€

---

## ğŸ” ××‘×˜×—×”

âš ï¸ **×œ×¤× ×™ ×™×™×¦×•×¨:**
1. ×©× ×” `SECRET_KEY` ×‘×§×•×‘×¥ `.env`
2. ×”×’×“×¨ `DEBUG=False`
3. ×”×©×ª××© ×‘-HTTPS
4. ×¢×©×” backup ×§×‘×•×¢ ×œ××¡×“ ×”× ×ª×•× ×™× ×•×œ-`ml_model.pkl`

---

## ğŸ“Š ××‘× ×” ××¡×“ ×”× ×ª×•× ×™×

```
users               â†’ ××©×ª××©×™× (××¤×§×“×™×)
plugot              â†’ ×¤×œ×•×’×•×ª
mahalkot            â†’ ××—×œ×§×•×ª
soldiers            â†’ ×—×™×™×œ×™×
certifications      â†’ ×”×¡××›×•×ª
unavailable_dates   â†’ ×ª××¨×™×›×™× ×œ× ×–××™× ×™×
assignment_templates â†’ ×ª×‘× ×™×•×ª ××©×™××•×ª
shavzakim           â†’ ×©×™×‘×•×¦×™×
assignments         â†’ ××©×™××•×ª ×‘×©×™×‘×•×¥
assignment_soldiers â†’ ×§×™×©×•×¨ ×—×™×™×œ×™× ×œ××©×™××•×ª
soldier_status      â†’ ×¡×˜×˜×•×¡ ×—×™×™×œ×™×
```

---

## ğŸ“ ×¨×™×©×™×•×Ÿ

MIT License - ×¨××” ×§×•×‘×¥ LICENSE

---

## ğŸ“ ×ª××™×›×”

×©××œ×•×ª? ×‘×¢×™×•×ª?
1. ×‘×“×•×§ ××ª `/api/health`
2. ×‘×“×•×§ ×¡×˜×˜×™×¡×˜×™×§×•×ª ML ×‘-`/api/ml/stats`
3. ×¨××” Debug ×œ××¢×œ×”
4. ×¤×ª×— issue ×‘-GitHub

---

**× ×‘× ×” ×¢× â¤ï¸ ×•-AI ×‘×™×©×¨××œ ğŸ‡®ğŸ‡±**

**POWERED BY MACHINE LEARNING ğŸ¤–**
