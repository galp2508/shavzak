import{c as N,u as ys,f as js,r as x,b as y,Q as h,j as e,S as vs,U as ze}from"./index-kMap4_bO.js";import{u as ws,a as $e,T as oe,C as Ns,b as ks,R as Ee,B as ne,D as X,c as U,d as W,Z as Ss,e as Cs,f as _s,S as zs,h as $s,A as Es,g as Ms,i as As,k as Ls,s as Fs,K as Is,P as Ts,l as Os,m as Rs,j as Ds}from"./AssignmentModal-ClduxM9f.js";import{C as ie}from"./calendar-DM7sXBOg.js";import{T as Bs}from"./trash-2-DOb-ffsu.js";import{A as Hs}from"./award-ByqoaFCX.js";import{C as de}from"./clock-D8LmE10u.js";import{a as ce}from"./plus-To19C88C.js";import"./save-CzFpPGv-.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=N("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=N("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=N("Eraser",[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21",key:"182aya"}],["path",{d:"M22 21H7",key:"t4ddhn"}],["path",{d:"m5 11 9 9",key:"1mo9qw"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=N("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=N("LayoutList",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}],["path",{d:"M14 4h7",key:"3xa0d5"}],["path",{d:"M14 9h7",key:"1icrd9"}],["path",{d:"M14 15h7",key:"1mj8o2"}],["path",{d:"M14 20h7",key:"11slyb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=N("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=N("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=N("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xs=N("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=N("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=N("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),Js=({name:r})=>{const{attributes:k,listeners:d,setNodeRef:p,transform:o,transition:j}=Os({id:r}),F={transform:Rs.Transform.toString(o),transition:j,cursor:"grab",touchAction:"none"};return e.jsx("div",{ref:p,style:F,...k,...d,className:"flex-1 min-w-[200px] font-bold text-center p-2 bg-gray-100 border-l border-gray-300 select-none hover:bg-gray-200 active:cursor-grabbing",children:r})},it=()=>{var Se,Ce,_e;const{user:r}=ys(),{ditto:k}=js(),[d,p]=x.useState(null),[o,j]=x.useState(null),[F,K]=x.useState([]),[E,C]=x.useState(!0),[b,I]=x.useState(!1),[Ae,R]=x.useState(!1),[Le,D]=x.useState(null),[me,xe]=x.useState(!1),[Y,Fe]=x.useState({}),[u,Ie]=x.useState(null),[_,T]=x.useState(null),[M,B]=x.useState(null),[he,ge]=x.useState(!1),[Te,H]=x.useState(!1),[J,Oe]=x.useState(null),[Re,pe]=x.useState(()=>{const s=localStorage.getItem("shavzakColumnOrder");return s?JSON.parse(s):[]}),[O,V]=x.useState(1),[Q,ue]=x.useState(window.innerWidth<768?"list":"grid"),[fe,be]=x.useState(null),[De,Be]=x.useState(1),[ee,He]=x.useState(window.innerWidth>=768),[z,se]=x.useState(!1),Pe=ws($e(Ts,{activationConstraint:{distance:8}}),$e(Is,{coordinateGetter:Fs})),Ze=()=>{document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen().then(()=>{se(!1)}):document.documentElement.requestFullscreen().then(()=>{se(!0)}).catch(s=>{console.error(`Error attempting to enable full-screen mode: ${s.message} (${s.name})`)})};x.useEffect(()=>{const s=()=>{se(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",s),()=>document.removeEventListener("fullscreenchange",s)},[]);const Ge=s=>{const{active:t,over:a}=s;t.id!==a.id&&pe(n=>{const l=n.indexOf(t.id),m=n.indexOf(a.id),i=Ls(n,l,m);return localStorage.setItem("shavzakColumnOrder",JSON.stringify(i)),i})},Ue=async()=>{if(d&&window.confirm("×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×ž×—×•×§ ××ª ×›×œ ×”×©×™×‘×•×¦×™× ×œ×™×•× ×–×”? ×¤×¢×•×œ×” ×–×• ××™× ×” ×”×¤×™×›×”."))try{C(!0);const s=d.toISOString().split("T")[0];await y.delete(`/plugot/${r.pluga_id}/live-schedule/days/${s}`),h.success("×”×©×™×‘×•×¥ ×œ×™×•× ×–×” × ×ž×—×§ ×‘×”×¦×œ×—×”"),v(d)}catch(s){console.error("Error deleting day schedule:",s),h.error("×©×’×™××” ×‘×ž×—×™×§×ª ×”×©×™×‘×•×¥")}finally{C(!1)}},We=async()=>{if(d&&window.confirm("×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ× ×§×•×ª ××ª ×›×œ ×”×—×™×™×œ×™× ×ž×”×©×™×‘×•×¥ ×œ×™×•× ×–×”? ×”×ž×©×™×ž×•×ª ×™×™×©××¨×• ×¨×™×§×•×ª."))try{C(!0);const s=d.toISOString().split("T")[0];await y.post(`/plugot/${r.pluga_id}/live-schedule/days/${s}/clear-soldiers`),h.success("×”×—×™×™×œ×™× × ×•×§×• ×ž×”×©×™×‘×•×¥ ×‘×”×¦×œ×—×”"),v(d)}catch(s){console.error("Error clearing day soldiers:",s),h.error("×©×’×™××” ×‘× ×™×§×•×™ ×”×—×™×™×œ×™× ×ž×”×©×™×‘×•×¥")}finally{C(!1)}},[qe,te]=x.useState(!1),Xe=()=>{te(!0)},Ke=async(s,t)=>{if(te(!1),s==="excel")try{const a=d.toISOString().split("T")[0],n=await y.get(`/plugot/${r.pluga_id}/export/csv?start_date=${a}&days_count=${t}`,{responseType:"blob"}),l=window.URL.createObjectURL(new Blob([n.data])),m=document.createElement("a");m.href=l,m.setAttribute("download",`shavzak_export_${a}_${t}days.csv`),document.body.appendChild(m),m.click(),m.remove(),h.success("×”×§×•×‘×¥ ×™×¨×“ ×‘×”×¦×œ×—×”")}catch(a){console.error("Export excel error:",a),h.error("×©×’×™××” ×‘×™×™×¦×•× ×œ××§×¡×œ")}else{t>1&&h.info("×™×™×¦×•× ×ª×ž×•× ×” ×ž×¨×•×‘×” ×™×ž×™× ×‘×¤×™×ª×•×—. ×ž×™×™×¦× ××ª ×”×™×•× ×”× ×•×›×—×™ ×‘×œ×‘×“.");const a=document.getElementById("schedule-grid");if(!a)return;try{const n=a.cloneNode(!0),l=n.querySelector(".min-w-max");l&&(l.style.zoom="1"),n.style.width="fit-content",n.style.height="auto",n.style.overflow="visible",n.style.position="absolute",n.style.top="-9999px",n.style.left="-9999px",document.body.appendChild(n);const m=await Ds(n,{scale:2,useCORS:!0,backgroundColor:"#ffffff",windowWidth:n.scrollWidth,windowHeight:n.scrollHeight});document.body.removeChild(n);const i=document.createElement("a");if(i.download=`shavzak-${d.toISOString().split("T")[0]}.png`,i.href=m.toDataURL("image/png"),i.click(),/Android|iPhone/i.test(navigator.userAgent))try{const g=await(await fetch(m.toDataURL("image/png"))).blob(),c=new File([g],"shavzak.png",{type:"image/png"});navigator.canShare&&navigator.canShare({files:[c]})&&await navigator.share({files:[c],title:"×©×™×‘×•×¥ ×§×¨×‘×™",text:"×”×©×™×‘×•×¥ ×”×™×•×ž×™ ×ž×•×›×Ÿ!"})}catch(g){console.log("Sharing failed",g)}h.success("×”×ª×ž×•× ×” × ×©×ž×¨×” ×‘×”×¦×œ×—×”!")}catch(n){console.error("Export error:",n),h.error("×©×’×™××” ×‘×™×™×¦×•× ×”×ª×ž×•× ×”")}}};x.useEffect(()=>{if(o!=null&&o.assignments){const s=[...new Set(o.assignments.map(t=>t.name))].sort();pe(t=>{if(t.length===0)return s;const a=s.filter(l=>!t.includes(l));return[...t.filter(l=>s.includes(l)),...a]})}},[o]),x.useEffect(()=>{const s=new Date;s.setDate(s.getDate()+1),p(s),Ye(),re()},[]),x.useEffect(()=>{d&&v(d)},[d]),x.useEffect(()=>{if(!k||!d)return;console.log("ðŸ”Œ Subscribing to Ditto changes...");const s=k.store.collection("assignments").find("true").subscribe(),t=k.store.collection("assignments").find("true").observeLocal((a,n)=>{console.log("ðŸ”„ Ditto update received!",n),v(d)});return()=>{s.cancel(),t.stop()}},[k,d]),x.useEffect(()=>{const s=()=>{d&&v(d)};return window.addEventListener("templateChanged",s),()=>window.removeEventListener("templateChanged",s)},[d]),x.useEffect(()=>{const s=t=>{["INPUT","TEXTAREA"].includes(t.target.tagName)||(t.key==="ArrowRight"?P(-1):t.key==="ArrowLeft"?P(1):t.key.toLowerCase()==="t"?p(new Date):t.key.toLowerCase()==="r"&&!t.ctrlKey&&!t.metaKey?(t.preventDefault(),v(d)):t.key.toLowerCase()==="g"&&((r==null?void 0:r.role)==="×ž×¤"||(r==null?void 0:r.role)==="×ž×ž"||(r==null?void 0:r.role)==="×ž×›")?(t.preventDefault(),ve()):t.key.toLowerCase()==="n"&&((r==null?void 0:r.role)==="×ž×¤"||(r==null?void 0:r.role)==="×ž×ž")?(t.preventDefault(),es()):t.key.toLowerCase()==="c"&&((r==null?void 0:r.role)==="×ž×¤"||(r==null?void 0:r.role)==="×ž×ž"||(r==null?void 0:r.role)==="×ž×›")?(t.preventDefault(),I(!0)):t.key==="Escape"&&_&&(T(null),h.info("×‘×—×™×¨×ª ×”×—×œ×¤×” ×‘×•×˜×œ×”",{icon:"âŒ"})))};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[d,_,r]);const Ye=async()=>{try{const s=await y.get(`/plugot/${r.pluga_id}/mahalkot`);K(s.data.mahalkot||[])}catch(s){console.error("Error loading mahalkot:",s)}},re=async()=>{try{const s=await y.get("/ml/stats");Ie(s.data.stats)}catch(s){console.error("Error loading ML stats:",s)}},Je=()=>{if(!o||!o.assignments)return{totalAssignments:0,totalSoldiers:0,avgWorkload:0,lowConfidenceCount:0,approvedCount:0,rejectedCount:0};const s=o.assignments,t=new Set;let a=0,n=0,l=0;s.forEach(g=>{g.soldiers&&g.soldiers.forEach(A=>t.add(A.id));const{level:c}=je(g);c==="× ×ž×•×š"&&a++;const w=Y[g.id];w==="approved"&&n++,w==="rejected"&&l++});let m=0;t.forEach(g=>{m+=ye(g)});const i=t.size>0?Math.round(m/t.size):0;return{totalAssignments:s.length,totalSoldiers:t.size,avgWorkload:i,lowConfidenceCount:a,approvedCount:n,rejectedCount:l}},ye=s=>{if(!o||!o.assignments)return 0;let t=0;return o.assignments.forEach(a=>{a.is_base_task||a.soldiers&&a.soldiers.some(l=>l.id===s)&&(t+=a.length_in_hours||0)}),t},je=s=>{let t=1;const a=[];if(!s.soldiers||s.soldiers.length===0)return t*=.3,a.push("××™×Ÿ ×—×™×™×œ×™× ×ž×©×•×‘×¦×™×"),{confidence:t,reasons:a,level:"× ×ž×•×š"};Y[s.id]==="rejected"&&(t*=.4,a.push("× ×“×—×ª×” ×‘×¢×‘×¨")),s.soldiers.filter(c=>!c.role||c.role==="×—×™×™×œ").length===s.soldiers.length&&(t*=.7,a.push("×›×œ ×”×—×™×™×œ×™× ×—×“×©×™×"));const m=["×¡×™×•×¨","×›×•× × ×•×ª ×"].includes(s.assignment_type),i=s.soldiers.some(c=>["×ž×›","×ž×ž","×¡×ž×œ"].includes(c.role));m&&!i&&(t*=.5,a.push("×—×¡×¨ ×ž×¤×§×“")),(s.start_hour>=22||s.start_hour<=6)&&(t*=.9);let g="×’×‘×•×”";return t<.5?g="× ×ž×•×š":t<.75&&(g="×‘×™× ×•× ×™"),{confidence:t,reasons:a,level:g}},v=async(s,t=!1)=>{var a;C(!0);try{const n=s.toISOString().split("T")[0],l=await y.get(`/plugot/${r.pluga_id}/live-schedule?date=${n}`);j(l.data);const m=new Date;m.setHours(0,0,0,0);const i=new Date(s);i.setHours(0,0,0,0),!t&&l.data.assignments&&l.data.assignments.length===0&&i>=m&&!he&&(console.log(`ðŸ“… ××™×Ÿ ×©×™×‘×•×¥ ×œ-${n} - ×‘×•× ×” ××•×˜×•×ž×˜×™×ª 2 ×™×ž×™× ×§×“×™×ž×”`),await Ve(s))}catch(n){const l=(a=n.response)==null?void 0:a.data;let m=(l==null?void 0:l.error)||n.message;l!=null&&l.suggestions&&l.suggestions.length>0&&(m+=`

×”×ž×œ×¦×•×ª:
`+l.suggestions.map(i=>`â€¢ ${i}`).join(`
`)),l!=null&&l.technical_details&&console.error("Technical details:",l.technical_details),h.error(m,{autoClose:8e3}),console.error("Load schedule error:",n)}finally{C(!1)}},Ve=async s=>{if(he){console.log("â³ ×›×‘×¨ ×‘×ª×”×œ×™×š ×™×¦×™×¨×” ××•×˜×•×ž×˜×™×ª - ×ž×“×œ×’");return}ge(!0);try{console.log("ðŸ¤– ×‘×•× ×” ×©×™×‘×•×¥ ××•×˜×•×ž×˜×™ ×œ×™×•×ž×™×™× ×§×“×™×ž×”..."),(await y.post("/ml/smart-schedule",{pluga_id:r.pluga_id,start_date:s.toISOString().split("T")[0],days_count:2})).data&&(await v(d,!0),console.log("âœ… ×©×™×‘×•×¥ ××•×˜×•×ž×˜×™ ×”×•×©×œ×"))}catch(t){console.error("×©×’×™××” ×‘×©×™×‘×•×¥ ××•×˜×•×ž×˜×™:",t)}finally{ge(!1)}},P=s=>{p(t=>{const a=new Date(t);return a.setDate(a.getDate()+s),a})},ve=async()=>{var s,t;if(window.confirm("×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×™×¦×•×¨ ×©×™×‘×•×¥ ×—×›× ×¢× AI ×œ×™×•×ž×™×™× ×”×‘××™×?")){xe(!0);try{const a=new Date(d),n=await y.post("/ml/smart-schedule",{pluga_id:r.pluga_id,start_date:a.toISOString().split("T")[0],days_count:2});n.data.failed_assignments&&n.data.failed_assignments.length>0?h.warning(`âš ï¸ ${n.data.message} - ${n.data.success_rate} ×”×¦×œ×™×—×•`):h.success(`ðŸ¤– ${n.data.message}`),v(d,!0),re()}catch(a){h.error(((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.error)||"×©×’×™××” ×‘×™×¦×™×¨×ª ×©×™×‘×•×¥ ×—×›×"),console.error("Smart schedule error:",a)}finally{xe(!1)}}},Z=async(s,t,a=null,n=null)=>{var l,m;try{if(t==="rejected"&&!a){Oe(s),H(!0);return}const i=o==null?void 0:o.shavzak_id;if(!i){h.error("×œ× × ×ž×¦× ×ž×–×”×” ×©×™×‘×•×¥");return}const g={assignment_id:s,shavzak_id:i,rating:t,enable_auto_regeneration:!1};if(a&&(g.changes={feedback_text:a,alternative_suggestion:n}),await y.post("/ml/feedback",g),Fe(c=>({...c,[s]:t})),t==="approved")h.success("âœ… ×¤×™×“×‘×§ ×—×™×•×‘×™ × ×©×ž×¨ - ×”×ž×•×“×œ ×œ×•×ž×“ ×ž×–×”!",{autoClose:3e3,icon:"ðŸŽ‰"});else if(t==="rejected"){h.info("ðŸ”„ ×ž× ×¡×” ×œ×ž×¦×•× ×©×™×‘×•×¥ ×˜×•×‘ ×™×•×ª×¨...",{autoClose:2e3});try{const c=await y.post("/ml/regenerate-assignment",{assignment_id:s});c.data.assignment&&(h.success("âœ… × ×ž×¦× ×©×™×‘×•×¥ ×—×œ×•×¤×™!",{icon:"ðŸ¤–"}),j(w=>{if(!w)return w;const A=w.assignments.map(L=>L.id===s?{...L,...c.data.assignment}:L);return{...w,assignments:A}}))}catch(c){console.error("Regeneration error:",c),h.warning("×œ× × ×ž×¦× ×©×™×‘×•×¥ ×—×œ×•×¤×™ ××•×˜×•×ž×˜×™ - × ×¡×” ×œ×¢×¨×•×š ×™×“× ×™×ª",{autoClose:5e3})}}re()}catch(i){const g=((m=(l=i.response)==null?void 0:l.data)==null?void 0:m.error)||"×©×’×™××” ×‘×©×ž×™×¨×ª ×¤×™×“×‘×§";h.error(g),console.error("Feedback error:",i)}},Qe=s=>{const t=F.find(a=>a.id===s);return(t==null?void 0:t.color)||"#6B7280"},we=s=>{const t=s.soldiers||[];if(t.length===0)return"#FBBF24";const a=t.filter(l=>l.role_in_assignment!=="× ×”×’");if(a.length===0)return"#FBBF24";const n=new Set(a.map(l=>l.mahlaka_id).filter(l=>l!=null));if(n.size>=2)return"#FBBF24";if(n.size===1){const l=Array.from(n)[0];return Qe(l)}return"#FBBF24"},Ne=s=>["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—×ž×™×©×™","×©×™×©×™","×©×‘×ª"][s.getDay()],es=()=>{D(null),R(!0)},ke=s=>{D(s),R(!0)},ss=()=>{R(!1),D(null)},ts=()=>{v(d)},rs=(s,t)=>{t.stopPropagation(),_?_.id===s.id?(T(null),h.info("×”×‘×—×™×¨×” ×‘×•×˜×œ×”",{icon:"âŒ"})):as(_,s):(T(s),h.info(`× ×‘×—×¨×” ×ž×©×™×ž×”: ${s.name}. ×œ×—×¥ ×¢×œ ×›×¤×ª×•×¨ ×”×—×œ×¤×” ×‘×ž×©×™×ž×” × ×•×¡×¤×ª`,{autoClose:3e3,icon:"ðŸ”„"}))},as=async(s,t)=>{var a,n;try{const l=[{id:s.id,start_hour:t.start_hour,name:t.name},{id:t.id,start_hour:s.start_hour,name:s.name}];await Promise.all(l.map(m=>y.patch(`/assignments/${m.id}/time`,{start_hour:m.start_hour,name:m.name}))),h.success("×”×ž×©×™×ž×•×ª ×”×•×—×œ×¤×• ×‘×”×¦×œ×—×”! ðŸ”„",{icon:"âœ…"}),T(null),v(d)}catch(l){console.error("Error swapping assignments:",l),h.error(((n=(a=l.response)==null?void 0:a.data)==null?void 0:n.error)||"×©×’×™××” ×‘×”×—×œ×¤×ª ×”×ž×©×™×ž×•×ª"),T(null)}},ls=(s,t,a)=>{a.stopPropagation(),M?M.soldier.id===s.id?(B(null),h.info("×”×‘×—×™×¨×” ×‘×•×˜×œ×”",{icon:"âŒ"})):os(M,{soldier:s,assignment:t}):(B({soldier:s,assignment:t}),h.info(`× ×‘×—×¨ ×—×™×™×œ: ${s.name}. ×œ×—×¥ ×¢×œ ×—×™×™×œ ××—×¨ ×œ×”×—×œ×¤×”`,{autoClose:3e3,icon:"ðŸ”„"}))},os=async(s,t)=>{try{const a=s.assignment.soldiers.map(l=>l.id===s.soldier.id?{...t.soldier,role:s.soldier.role_in_assignment}:l),n=t.assignment.soldiers.map(l=>l.id===t.soldier.id?{...s.soldier,role:t.soldier.role_in_assignment}:l);if(s.assignment.id===t.assignment.id){const l=s.assignment.soldiers.map(m=>m.id===s.soldier.id?{...t.soldier,role:s.soldier.role_in_assignment}:m.id===t.soldier.id?{...s.soldier,role:t.soldier.role_in_assignment}:m);await y.put(`/assignments/${s.assignment.id}/soldiers`,{soldiers:l.map(m=>({soldier_id:m.id,role:m.role}))})}else await Promise.all([y.put(`/assignments/${s.assignment.id}/soldiers`,{soldiers:a.map(l=>({soldier_id:l.id,role:l.role_in_assignment||"×—×™×™×œ"}))}),y.put(`/assignments/${t.assignment.id}/soldiers`,{soldiers:n.map(l=>({soldier_id:l.id,role:l.role_in_assignment||"×—×™×™×œ"}))})]);h.success("×”×—×™×™×œ×™× ×”×•×—×œ×¤×• ×‘×”×¦×œ×—×”! ðŸ”„",{icon:"âœ…"}),B(null),v(d)}catch(a){console.error("Error swapping soldiers:",a),h.error("×©×’×™××” ×‘×”×—×œ×¤×ª ×”×—×™×™×œ×™×"),B(null)}},ns=s=>{if(s.touches.length===2){const t=Math.hypot(s.touches[0].pageX-s.touches[1].pageX,s.touches[0].pageY-s.touches[1].pageY);be(t),Be(O)}},is=s=>{if(s.touches.length===2&&fe){const a=Math.hypot(s.touches[0].pageX-s.touches[1].pageX,s.touches[0].pageY-s.touches[1].pageY)/fe;V(Math.min(Math.max(De*a,.5),2))}},ds=()=>{be(null)},cs=()=>V(s=>Math.min(s+.1,2)),ms=()=>V(s=>Math.max(s-.1,.5));return E&&!o?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"spinner"})}):e.jsxs("div",{className:`space-y-4 md:space-y-6 ${z?"fixed inset-0 z-[100] bg-gray-100 overflow-auto p-2":""}`,children:[e.jsx("div",{className:`card bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 text-white shadow-2xl border-none p-3 md:p-6 ${z?"sticky top-0 z-50 rounded-none":""}`,children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-3 md:gap-4",children:[e.jsxs("div",{className:`flex items-center justify-between w-full md:w-auto ${z?"hidden":""}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-white bg-opacity-20 p-2 md:p-3 rounded-2xl backdrop-blur-sm animate-pulse-slow hidden md:block",children:e.jsx(ie,{className:"w-8 h-8 md:w-12 md:h-12"})}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-xl md:text-4xl font-bold tracking-tight",children:"×©×™×‘×•×¥ ×—×™"}),e.jsxs("span",{className:"bg-gradient-to-r from-yellow-400 to-orange-500 text-white text-[10px] md:text-xs px-2 py-0.5 md:px-3 md:py-1 rounded-full font-bold animate-pulse flex items-center gap-1",children:[e.jsx(qs,{size:10,className:"md:w-3 md:h-3"}),"LIVE"]})]}),e.jsx("p",{className:"text-purple-100 text-sm md:text-lg font-medium hidden md:block",children:"× ×™×•×•×˜ ××•×˜×•×ž×˜×™ ×‘×™×Ÿ ×™×ž×™× â€¢ ×œ×ž×™×“×ª ×ž×›×•× ×” ×¤×¢×™×œ×”"})]})]}),e.jsxs("button",{onClick:()=>He(!ee),className:"md:hidden p-2 bg-white/20 rounded-lg hover:bg-white/30 transition-colors flex items-center gap-1 text-xs font-bold",children:[e.jsx(oe,{size:16}),ee?"×”×¡×ª×¨ × ×ª×•× ×™×":"×”×¦×’ × ×ª×•× ×™×"]})]}),e.jsxs("div",{className:`flex items-center justify-between w-full md:w-auto gap-2 md:gap-4 bg-white bg-opacity-20 backdrop-blur-md rounded-xl md:rounded-2xl p-2 md:p-4 shadow-lg ${z?"flex-1":""}`,children:[e.jsx("button",{onClick:()=>P(-1),className:"p-1.5 md:p-3 hover:bg-white hover:bg-opacity-30 rounded-lg md:rounded-xl transition-all duration-300 active:scale-95 md:hover:scale-110 transform",title:"×™×•× ×§×•×“×",children:e.jsx(Ns,{size:20,className:"md:w-7 md:h-7"})}),e.jsxs("div",{className:"text-center min-w-[100px] md:min-w-[220px]",children:[e.jsx("div",{className:"text-lg md:text-3xl font-bold tracking-wide",children:d&&Ne(d)}),e.jsx("div",{className:"text-xs md:text-base opacity-90 font-medium mt-0.5 md:mt-1",children:d&&d.toLocaleDateString("he-IL")})]}),e.jsx("button",{onClick:()=>P(1),className:"p-1.5 md:p-3 hover:bg-white hover:bg-opacity-30 rounded-lg md:rounded-xl transition-all duration-300 active:scale-95 md:hover:scale-110 transform",title:"×™×•× ×”×‘×",children:e.jsx(ks,{size:20,className:"md:w-7 md:h-7"})})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 w-full md:w-auto flex-wrap",children:[(r.role==="×ž×¤"||r.role==="×ž×ž"||r.role==="×ž×›")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:ve,disabled:me,className:"bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white px-3 py-1.5 md:py-2 rounded-lg transition-all flex items-center gap-2 shadow-lg disabled:opacity-50 text-xs md:text-base flex-1 md:flex-none justify-center",title:"×™×¦×™×¨×ª ×©×™×‘×•×¥ ×—×›× ×¢× AI",children:me?e.jsxs(e.Fragment,{children:[e.jsx(Ee,{size:16,className:"animate-spin md:w-[18px] md:h-[18px]"}),e.jsx("span",{className:"inline",children:"×ž×™×™×¦×¨..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{size:16,className:"md:w-[18px] md:h-[18px]"}),e.jsx("span",{className:"inline",children:"×©×™×‘×•×¥ AI"})]})}),e.jsx("button",{onClick:()=>I(!0),className:"p-1.5 md:p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors",title:"××™×œ×•×¦×™ ×©×™×‘×•×¥",children:e.jsx(vs,{size:18,className:"md:w-6 md:h-6"})}),e.jsx("button",{onClick:Xe,className:"p-1.5 md:p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors",title:"×™×™×¦× ×œ×ª×ž×•× ×”",children:e.jsx(X,{size:18,className:"md:w-6 md:h-6"})}),e.jsx("button",{onClick:Ze,className:"p-1.5 md:p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors",title:z?"×¦× ×ž×ž×¡×š ×ž×œ×":"×ž×¡×š ×ž×œ×",children:z?e.jsx(Ws,{size:18,className:"md:w-6 md:h-6"}):e.jsx(Us,{size:18,className:"md:w-6 md:h-6"})}),e.jsx("button",{onClick:We,className:"p-1.5 md:p-2 hover:bg-orange-500 hover:bg-opacity-20 text-orange-200 hover:text-orange-100 rounded-lg transition-colors",title:"× ×§×” ×—×™×™×œ×™× (×”×©××¨ ×ž×©×™×ž×•×ª)",children:e.jsx(Zs,{size:18,className:"md:w-6 md:h-6"})}),e.jsx("button",{onClick:Ue,className:"p-2 hover:bg-red-500 hover:bg-opacity-20 text-red-600 hover:text-red-700 rounded-lg transition-colors",title:"×ž×—×§ ×©×™×‘×•×¥ ×œ×™×•× ×–×”",children:e.jsx(Bs,{size:20,className:"md:w-6 md:h-6"})})]}),e.jsx("button",{onClick:()=>v(d),className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors",title:"×¨×¢× ×Ÿ",disabled:E,children:e.jsx(Ee,{size:20,className:`md:w-6 md:h-6 ${E?"animate-spin":""}`})})]})]})}),(o==null?void 0:o.assignments)&&o.assignments.some(s=>s.is_ai_generated)&&((r==null?void 0:r.role)==="×ž×¤"||(r==null?void 0:r.role)==="×ž×ž"||(r==null?void 0:r.role)==="×ž×›")&&e.jsx("div",{className:"card bg-gradient-to-br from-purple-50 to-indigo-50 border-2 border-purple-300 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-purple-500 to-indigo-600 p-2 rounded-full",children:e.jsx(ne,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"×¤×™×“×‘×§ ×œ×ž×¢×¨×›×ª AI"}),e.jsx("p",{className:"text-sm text-gray-600",children:"×¢×‘×•×¨ ×¢×œ ×ž×©×™×ž×•×ª ×•×ª×Ÿ ×¤×™×“×‘×§ ×œ×©×™×¤×•×¨ ×”×ž×¢×¨×›×ª"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-green-50 px-4 py-2 rounded-lg border border-green-200",children:[e.jsx(U,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"××•×©×¨×•"}),e.jsx("div",{className:"text-lg font-bold text-green-700",children:(u==null?void 0:u.user_approvals)||0})]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-red-50 px-4 py-2 rounded-lg border border-red-200",children:[e.jsx(W,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"× ×“×—×•"}),e.jsx("div",{className:"text-lg font-bold text-red-700",children:(u==null?void 0:u.user_rejections)||0})]})]})]})]})}),ee&&!z&&e.jsxs("div",{className:"space-y-4 md:space-y-6 animate-fadeIn",children:[u&&e.jsx("div",{className:"card bg-gradient-to-r from-blue-50 via-purple-50 to-pink-50 border-l-4 border-blue-500 shadow-xl",children:e.jsxs("div",{className:"flex items-center gap-6 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 p-2 rounded-full",children:e.jsx(oe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium",children:"×“×™×¨×•×’ ××™×©×•×¨"}),e.jsxs("div",{className:"text-lg font-bold text-blue-700",children:[(Se=u.approval_rate)==null?void 0:Se.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 p-2 rounded-full",children:e.jsx(Hs,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium",children:"×“×¤×•×¡×™× ×©× ×œ×ž×“×•"}),e.jsx("div",{className:"text-lg font-bold text-purple-700",children:u.patterns_learned})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-gradient-to-br from-green-500 to-green-600 p-2 rounded-full",children:e.jsx(ne,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium",children:'×¡×”"×› ×©×™×‘×•×¦×™×'}),e.jsx("div",{className:"text-lg font-bold text-green-700",children:u.total_assignments})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-gradient-to-br from-emerald-400 to-emerald-500 p-2 rounded-full",children:e.jsx(U,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium",children:"××•×©×¨×•"}),e.jsx("div",{className:"text-lg font-bold text-emerald-700",children:u.user_approvals})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-gradient-to-br from-red-400 to-red-500 p-2 rounded-full",children:e.jsx(W,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium",children:"× ×“×—×•"}),e.jsx("div",{className:"text-lg font-bold text-red-700",children:u.user_rejections})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-gradient-to-br from-yellow-400 to-orange-500 p-2 rounded-full animate-pulse",children:e.jsx(Ss,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium",children:"××—×•×– ×”×¦×œ×—×”"}),e.jsxs("div",{className:"text-lg font-bold text-orange-700",children:[u.total_assignments>0?(u.user_approvals/u.total_assignments*100).toFixed(1):0,"%"]})]})]})]})}),(o==null?void 0:o.assignments)&&o.assignments.length>0&&e.jsxs("div",{className:"card bg-gradient-to-br from-slate-50 via-gray-50 to-zinc-50 border-2 border-slate-300 shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"bg-gradient-to-br from-slate-600 to-gray-700 p-2 rounded-full",children:e.jsx(oe,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"×¡×˜×˜×™×¡×˜×™×§×•×ª ×”×™×•×"}),e.jsx("p",{className:"text-xs text-gray-600",children:"×¡×™×›×•× ×ž×”×™×¨ ×©×œ ×”×©×™×‘×•×¥"})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3",children:(()=>{const s=Je();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white p-3 rounded-lg border-2 border-blue-200 hover:border-blue-400 transition-all hover:shadow-md",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ie,{className:"w-4 h-4 text-blue-600"}),e.jsx("div",{className:"text-xs text-gray-500 font-medium mb-1",children:"×ž×©×™×ž×•×ª"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-700",children:s.totalAssignments})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border-2 border-purple-200 hover:border-purple-400 transition-all hover:shadow-md",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ze,{className:"w-4 h-4 text-purple-600"}),e.jsx("div",{className:"text-xs text-gray-500 font-medium mb-1",children:"×—×™×™×œ×™×"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-700",children:s.totalSoldiers})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border-2 border-indigo-200 hover:border-indigo-400 transition-all hover:shadow-md",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(de,{className:"w-4 h-4 text-indigo-600"}),e.jsx("div",{className:"text-xs text-gray-500 font-medium mb-1",children:"×ž×ž×•×¦×¢ ×©×¢×•×ª"})]}),e.jsxs("div",{className:"text-2xl font-bold text-indigo-700",children:[s.avgWorkload,"×©'"]})]}),e.jsxs("div",{className:`bg-white p-3 rounded-lg border-2 transition-all hover:shadow-md ${s.lowConfidenceCount>0?"border-yellow-300 hover:border-yellow-500 animate-pulse-slow":"border-gray-200 hover:border-gray-400"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(q,{className:`w-4 h-4 ${s.lowConfidenceCount>0?"text-yellow-600":"text-gray-400"}`}),e.jsx("div",{className:"text-xs text-gray-500 font-medium mb-1",children:"××–×”×¨×•×ª"})]}),e.jsx("div",{className:`text-2xl font-bold ${s.lowConfidenceCount>0?"text-yellow-700":"text-gray-400"}`,children:s.lowConfidenceCount})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border-2 border-green-200 hover:border-green-400 transition-all hover:shadow-md",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(U,{className:"w-4 h-4 text-green-600"}),e.jsx("div",{className:"text-xs text-gray-500 font-medium mb-1",children:"××•×©×¨×•"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-700",children:s.approvedCount})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border-2 border-red-200 hover:border-red-400 transition-all hover:shadow-md",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(W,{className:"w-4 h-4 text-red-600"}),e.jsx("div",{className:"text-xs text-gray-500 font-medium mb-1",children:"× ×“×—×•"})]}),e.jsx("div",{className:"text-2xl font-bold text-red-700",children:s.rejectedCount})]})]})})()})]}),e.jsxs("div",{className:"card bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-blue-500 shadow-md",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("kbd",{className:"px-3 py-2 bg-gradient-to-br from-blue-500 to-indigo-600 text-white rounded-lg text-sm font-bold shadow-md",children:"âŒ¨ï¸"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-gray-800",children:"×§×™×¦×•×¨×™ ×ž×§×œ×“×ª"}),e.jsx("p",{className:"text-xs text-gray-600",children:"×œ× ×™×•×•×˜ ×•×¤×¢×•×œ×•×ª ×ž×”×™×¨×•×ª"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-700",children:[e.jsx("kbd",{className:"px-2 py-1 bg-white border-2 border-blue-300 rounded text-xs font-bold",children:"â†"}),e.jsx("span",{className:"text-xs",children:"×™×•× ×”×‘×"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-blue-700",children:[e.jsx("kbd",{className:"px-2 py-1 bg-white border-2 border-blue-300 rounded text-xs font-bold",children:"â†’"}),e.jsx("span",{className:"text-xs",children:"×™×•× ×§×•×“×"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-green-700",children:[e.jsx("kbd",{className:"px-2 py-1 bg-white border-2 border-green-300 rounded text-xs font-bold",children:"T"}),e.jsx("span",{className:"text-xs",children:"×—×–×•×¨ ×œ×”×™×•×"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-purple-700",children:[e.jsx("kbd",{className:"px-2 py-1 bg-white border-2 border-purple-300 rounded text-xs font-bold",children:"R"}),e.jsx("span",{className:"text-xs",children:"×¨×¢× ×Ÿ"})]}),((r==null?void 0:r.role)==="×ž×¤"||(r==null?void 0:r.role)==="×ž×ž"||(r==null?void 0:r.role)==="×ž×›")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-emerald-700",children:[e.jsx("kbd",{className:"px-2 py-1 bg-white border-2 border-emerald-300 rounded text-xs font-bold",children:"G"}),e.jsx("span",{className:"text-xs",children:"×©×™×‘×•×¥ AI"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-orange-700",children:[e.jsx("kbd",{className:"px-2 py-1 bg-white border-2 border-orange-300 rounded text-xs font-bold",children:"C"}),e.jsx("span",{className:"text-xs",children:"××™×œ×•×¦×™×"})]})]}),((r==null?void 0:r.role)==="×ž×¤"||(r==null?void 0:r.role)==="×ž×ž")&&e.jsxs("div",{className:"flex items-center gap-2 text-indigo-700",children:[e.jsx("kbd",{className:"px-2 py-1 bg-white border-2 border-indigo-300 rounded text-xs font-bold",children:"N"}),e.jsx("span",{className:"text-xs",children:"×ž×©×™×ž×” ×—×“×©×”"})]}),_&&e.jsxs("div",{className:"flex items-center gap-2 text-red-700 animate-pulse",children:[e.jsx("kbd",{className:"px-2 py-1 bg-white border-2 border-red-300 rounded text-xs font-bold",children:"ESC"}),e.jsx("span",{className:"text-xs",children:"×‘×™×˜×•×œ ×”×—×œ×¤×”"})]})]})]})]}),E?e.jsxs("div",{className:"card text-center py-12",children:[e.jsx("div",{className:"spinner mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"×˜×•×¢×Ÿ ×©×™×‘×•×¥..."})]}):((Ce=o==null?void 0:o.assignments)==null?void 0:Ce.length)===0?e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(ie,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-gray-700 mb-2",children:"××™×Ÿ ×ž×©×™×ž×•×ª ×œ×™×•× ×–×”"}),e.jsxs("p",{className:"text-gray-500",children:["×œ× × ×ž×¦××• ×ž×©×™×ž×•×ª ×œ×ª××¨×™×š ",o==null?void 0:o.date_display]}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"×•×“× ×©×™×© ×ª×‘× ×™×•×ª ×ž×©×™×ž×•×ª ×ž×•×’×“×¨×•×ª ×‘×ž×¢×¨×›×ª"})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:["×œ×•×— ×©×¢×•×ª - ",Ne(d)]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>ue("list"),className:`p-1 rounded-md transition-colors ${Q==="list"?"bg-white shadow text-blue-600":"hover:bg-white/50 text-gray-500"}`,title:"×ª×¦×•×’×ª ×¨×©×™×ž×”",children:e.jsx(Me,{size:18})}),e.jsx("button",{onClick:()=>ue("grid"),className:`p-1 rounded-md transition-colors ${Q==="grid"?"bg-white shadow text-blue-600":"hover:bg-white/50 text-gray-500"}`,title:"×ª×¦×•×’×ª ×˜×‘×œ×”",children:e.jsx(Gs,{size:18})})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-gray-100 rounded-lg p-1",dir:"ltr",children:[e.jsx("button",{onClick:ms,className:"p-1 hover:bg-white rounded-md transition-colors disabled:opacity-50",disabled:O<=.5,title:"×”×§×˜×Ÿ ×ª×¦×•×’×”",children:e.jsx(Ys,{size:18})}),e.jsxs("span",{className:"text-xs font-medium w-10 text-center",children:[Math.round(O*100),"%"]}),e.jsx("button",{onClick:cs,className:"p-1 hover:bg-white rounded-md transition-colors disabled:opacity-50",disabled:O>=2,title:"×”×’×“×œ ×ª×¦×•×’×”",children:e.jsx(Ks,{size:18})})]}),e.jsxs("span",{className:"text-sm text-gray-500 hidden sm:inline",children:[(_e=o==null?void 0:o.assignments)==null?void 0:_e.length," ×ž×©×™×ž×•×ª"]})]})]}),Q==="list"?e.jsx("div",{className:"space-y-3",children:(()=>{const s=[...(o==null?void 0:o.assignments)||[]].sort((t,a)=>t.start_hour!==a.start_hour?t.start_hour-a.start_hour:t.name.localeCompare(a.name));return s.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"××™×Ÿ ×ž×©×™×ž×•×ª ×œ×”×¦×’×”"}):s.map(t=>{const a=t.display_start_hour!==void 0?t.display_start_hour:t.start_hour||0,n=t.display_length_in_hours!==void 0?t.display_length_in_hours:t.length_in_hours||1,l=a+n,m=we(t);return e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden active:scale-[0.99] transition-transform",onClick:()=>(r.role==="×ž×¤"||r.role==="×ž×ž")&&ke(t),children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-2",style:{backgroundColor:m}}),e.jsxs("div",{className:"flex-1 p-3",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900",children:t.name}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-500 mt-0.5",children:[e.jsx(de,{size:14}),e.jsxs("span",{children:[a.toString().padStart(2,"0"),":00 - ",l.toString().padStart(2,"0"),":00"]})]})]}),(r.role==="×ž×¤"||r.role==="×ž×ž")&&e.jsx(ce,{size:16,className:"text-gray-400"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.soldiers&&t.soldiers.length>0?t.soldiers.map(i=>e.jsxs("div",{className:"flex items-center gap-1.5 bg-gray-50 px-2 py-1 rounded-md border border-gray-100",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-gray-200 flex items-center justify-center text-[10px] font-bold text-gray-600",children:i.name?i.name[0]:"?"}),e.jsx("span",{className:"text-sm text-gray-700",children:i.name})]},i.id)):e.jsxs("span",{className:"text-sm text-red-400 italic flex items-center gap-1",children:[e.jsx(q,{size:14}),"×œ×œ× ×—×™×™×œ×™×"]})})]})]})},t.id)})})()}):e.jsx("div",{className:"overflow-x-auto touch-pan-x touch-pan-y",id:"schedule-grid",onTouchStart:ns,onTouchMove:is,onTouchEnd:ds,children:(()=>{var l,m;let s=Re;const t=[...new Set(((l=o==null?void 0:o.assignments)==null?void 0:l.map(i=>i.name))||[])].sort();if(!s||s.length===0)s=t;else{const i=t.filter(g=>!s.includes(g));i.length>0&&(s=[...s,...i]),s=s.filter(g=>t.includes(g))}const a={};s.forEach(i=>{a[i]=[]}),(m=o==null?void 0:o.assignments)==null||m.forEach(i=>{a[i.name]||(a[i.name]=[]),a[i.name].push(i)});const n=Array.from({length:24},(i,g)=>g);return e.jsx(Cs,{sensors:Pe,collisionDetection:_s,onDragEnd:Ge,children:e.jsxs("div",{className:"min-w-max",style:{zoom:O},children:[e.jsxs("div",{className:"flex border-b-2 border-gray-300 mb-2",children:[e.jsx("div",{className:"w-20 flex-shrink-0 font-bold text-gray-700 p-2",children:"×©×¢×”"}),e.jsx(zs,{items:s,strategy:$s,children:s.map(i=>e.jsx(Js,{name:i},i))})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-20 flex-shrink-0",children:n.map(i=>e.jsxs("div",{className:"h-12 flex items-center justify-center border-b border-gray-200 text-sm text-gray-600 font-medium",children:[i.toString().padStart(2,"0"),":00"]},i))}),s.map(i=>{var g;return e.jsxs("div",{className:"flex-1 min-w-[200px] border-l border-gray-300 relative",children:[n.map(c=>e.jsx("div",{className:"h-12 border-b border-gray-200"},c)),e.jsx("div",{className:"absolute inset-0 pointer-events-none",children:(g=a[i])==null?void 0:g.map(c=>{const w=c.display_start_hour!==void 0?c.display_start_hour:c.start_hour||0,A=c.display_length_in_hours!==void 0?c.display_length_in_hours:c.length_in_hours||1,L=w+A,ae=we(c),xs=w/24*100,hs=A/24*100,$=Y[c.id],gs=$==="approved"||$==="rejected",le=_&&_.id===c.id,ps=le?"ring-4 ring-yellow-500 shadow-yellow-500/50 animate-pulse":"";return e.jsxs("div",{className:`absolute rounded-lg shadow-md overflow-visible group hover:shadow-2xl transition-all duration-300 hover:scale-[1.02] transform border pointer-events-auto ${ps}`,style:{top:`calc(${xs}% + 2px)`,height:`calc(${hs}% - 4px)`,left:"6px",right:"6px",background:`linear-gradient(135deg, ${ae} 0%, ${ae}dd 100%)`,borderColor:ae},onClick:()=>(r.role==="×ž×¤"||r.role==="×ž×ž")&&ke(c),title:`${c.name} (${w.toString().padStart(2,"0")}:00 - ${L.toString().padStart(2,"0")}:00)`,children:[gs&&e.jsx("div",{className:"absolute -top-2 -right-2 z-20 pointer-events-none",children:$==="approved"?e.jsx("div",{className:"bg-gradient-to-br from-green-400 to-emerald-600 text-white p-1 rounded-full shadow-lg animate-scale-in",children:e.jsx(Ps,{className:"w-4 h-4"})}):e.jsx("div",{className:"bg-gradient-to-br from-red-400 to-rose-600 text-white p-1 rounded-full shadow-lg animate-scale-in",children:e.jsx(Xs,{className:"w-4 h-4"})})}),(()=>{const{confidence:f,reasons:S,level:G}=je(c);return G==="× ×ž×•×š"?e.jsx("div",{className:"absolute top-1 right-12 z-20 pointer-events-auto",title:`×‘×™×˜×—×•×Ÿ × ×ž×•×š (${(f*100).toFixed(0)}%)
×¡×™×‘×•×ª:
${S.join(`
`)}`,children:e.jsxs("div",{className:"bg-yellow-500 text-white px-2 py-1 rounded-full text-xs font-bold shadow-lg flex items-center gap-1 animate-pulse",children:[e.jsx(q,{className:"w-3 h-3"}),"×‘×™×˜×—×•×Ÿ × ×ž×•×š"]})}):G==="×‘×™× ×•× ×™"?e.jsx("div",{className:"absolute top-1 right-12 z-20 pointer-events-auto opacity-70 hover:opacity-100",title:`×‘×™×˜×—×•×Ÿ ×‘×™× ×•× ×™ (${(f*100).toFixed(0)}%)
${S.length>0?`×¡×™×‘×•×ª:
${S.join(`
`)}`:"×œ×œ× ×”×ª×¨××•×ª"}`,children:e.jsxs("div",{className:"bg-orange-400 text-white px-2 py-1 rounded-full text-xs font-bold shadow-md flex items-center gap-1",children:[e.jsx(q,{className:"w-3 h-3"}),"×‘×“×•×§"]})}):null})(),e.jsxs("div",{className:"p-2 h-full flex flex-col text-white backdrop-blur-sm relative overflow-y-auto",children:[(r.role==="×ž×¤"||r.role==="×ž×ž")&&e.jsx("div",{className:"absolute top-1 right-1 bg-white/30 rounded p-0.5 opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:e.jsx(ce,{className:"w-3 h-3"})}),(r.role==="×ž×¤"||r.role==="×ž×ž")&&e.jsx("button",{onClick:f=>rs(c,f),className:`absolute bottom-1 right-1 rounded-md p-1.5 transition-all duration-200 z-10 pointer-events-auto shadow-lg ${le?"bg-yellow-500 text-white animate-pulse scale-110":"bg-white/40 hover:bg-yellow-400 hover:text-white opacity-70 hover:opacity-100 hover:scale-105"}`,title:le?"×œ×—×¥ ×©×•×‘ ×œ×‘×™×˜×•×œ ××• ×œ×—×¥ ×¢×œ ×ž×©×™×ž×” ××—×¨×ª ×œ×”×—×œ×¤×”":"×”×—×œ×£ ×ž×©×™×ž×” ×–×• ×¢× ××—×¨×ª",children:e.jsx(Es,{className:"w-3.5 h-3.5"})}),((r==null?void 0:r.role)==="×ž×¤"||(r==null?void 0:r.role)==="×ž×ž"||(r==null?void 0:r.role)==="×ž×›")&&e.jsxs("div",{className:"absolute top-1 left-1 z-10 flex gap-1 pointer-events-auto",children:[e.jsx("button",{onClick:f=>{f.stopPropagation(),Z(c.id,"approved")},className:`bg-gradient-to-br hover:from-green-500 hover:to-emerald-700 text-white p-1.5 rounded-full shadow-lg transition-all duration-200 hover:scale-110 transform ${$==="approved"?"from-green-500 to-emerald-700 ring-2 ring-white":"from-green-400 to-emerald-600"}`,title:$==="approved"?"×©×™×‘×•×¥ ×ž××•×©×¨ - ×œ×—×¥ ×©×•×‘ ×œ×‘×™×˜×•×œ":"××™×©×•×¨ ×©×™×‘×•×¥ - ×”×ž×¢×¨×›×ª ×ª×œ×ž×“ ×ž×”×¤×™×“×‘×§",children:e.jsx(U,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:f=>{f.stopPropagation(),Z(c.id,"rejected")},className:`bg-gradient-to-br hover:from-red-500 hover:to-rose-700 text-white p-1.5 rounded-full shadow-lg transition-all duration-200 hover:scale-110 transform ${$==="rejected"?"from-red-500 to-rose-700 ring-2 ring-white":"from-red-400 to-rose-600"}`,title:$==="rejected"?"×©×™×‘×•×¥ × ×“×—×” - ×œ×—×¥ ×©×•×‘ ×œ×‘×™×˜×•×œ":"×“×—×™×™×ª ×©×™×‘×•×¥ - ×”×ž×¢×¨×›×ª ×ª×œ×ž×“ ×ž×”×¤×™×“×‘×§",children:e.jsx(W,{className:"w-3.5 h-3.5"})})]}),e.jsxs("div",{className:"font-bold text-sm mb-1 flex items-center gap-1.5",children:[e.jsx(de,{className:"w-3.5 h-3.5"}),c.name]}),e.jsxs("div",{className:"text-xs opacity-95 mb-1.5 font-medium bg-black bg-opacity-20 rounded px-1.5 py-0.5 inline-block",children:[w.toString().padStart(2,"0"),":00 - ",L.toString().padStart(2,"0"),":00"]}),c.soldiers&&c.soldiers.length>0&&e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"space-y-1",children:c.soldiers.map(f=>{const S=ye(f.id),G=Math.min(S/60*100,100),us=S>40?"bg-red-500":S>20?"bg-yellow-500":"bg-green-500",fs=M&&M.soldier.id===f.id&&M.assignment.id===c.id;return e.jsxs("div",{onClick:bs=>(r.role==="×ž×¤"||r.role==="×ž×ž")&&ls(f,c,bs),className:`text-xs backdrop-blur-md px-2 py-1 rounded border shadow-sm transition-all duration-200 cursor-pointer
                                                ${fs?"bg-yellow-500 border-yellow-300 ring-2 ring-yellow-300 animate-pulse text-white":"bg-white/25 border-white/30 hover:bg-white/35 text-white"}
                                              `,children:[e.jsxs("div",{className:"font-semibold flex items-center justify-between gap-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ze,{className:"w-2.5 h-2.5"}),f.name]}),e.jsxs("span",{className:"text-[10px] font-bold opacity-90",children:[S,"×©'"]})]}),e.jsx("div",{className:"text-[10px] opacity-90 font-medium mb-1",children:f.role_in_assignment}),e.jsx("div",{className:"h-1 w-full bg-white/30 rounded-full overflow-hidden mt-1",children:e.jsx("div",{className:`h-full ${us} transition-all duration-500`,style:{width:`${G}%`},title:`${S} ×©×¢×•×ª ×¢×‘×•×“×”`})})]},f.id)})})}),(!c.soldiers||c.soldiers.length===0)&&e.jsx("div",{className:"text-xs opacity-80 italic bg-red-500/30 px-2 py-1 rounded border border-red-400/50",children:"××™×Ÿ ×—×™×™×œ×™× ×ž×©×•×‘×¦×™×"})]})]},c.id)})})]},i)})]})]})})})()})]})}),b&&e.jsx(Ms,{onClose:()=>I(!1),onUpdate:()=>{d&&v(d)}}),Te&&e.jsx(Vs,{onClose:()=>H(!1),onSubmit:s=>{Z(J,"rejected",s),H(!1)},onEdit:s=>{Z(J,"rejected",s),H(!1);let t=null;o!=null&&o.assignments&&(t=o.assignments.find(a=>a.id===J)),t?(D(t),R(!0)):h.error("×œ× × ×™×ª×Ÿ ×œ×¤×ª×•×— ×¢×¨×™×›×” - ×”×ž×©×™×ž×” ×œ× × ×ž×¦××”")}}),Ae&&e.jsx(As,{assignment:Le,date:d,dayIndex:o==null?void 0:o.day_index,shavzakId:o==null?void 0:o.shavzak_id,plugaId:r.pluga_id,onClose:ss,onSave:ts}),qe&&e.jsx(Qs,{onClose:()=>te(!1),onExport:Ke})]})},Vs=({onClose:r,onSubmit:k,onEdit:d})=>{const[p,o]=x.useState(""),[j,F]=x.useState(""),K=["×ž×—×œ×§×” ×œ× × ×ž×¦××ª (×‘×‘×™×ª)","×œ× ×‘×œ×‘× ×” ×©×œ×”×","×—×™×™×œ×™× ×œ× ×ž×ª××™×ž×™×","×—×•×¡×¨ ×‘×ž×¤×§×“×™×/× ×”×’×™×","××—×¨"],E=()=>{const b=p==="××—×¨"?j:p;b&&k(b)},C=()=>{const b=p==="××—×¨"?j:p;b&&d(b)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[70] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full p-6 animate-fadeIn",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"×œ×ž×” ×”×©×™×‘×•×¥ ×œ× ×˜×•×‘?"}),e.jsx("p",{className:"text-gray-600 mb-4 text-sm",children:"×”×¡×‘×¨ ×§×¦×¨ ×™×¢×–×•×¨ ×œ×ž×¢×¨×›×ª ×œ×œ×ž×•×“ ×•×œ×”×©×ª×¤×¨ ×œ×¤×¢× ×”×‘××”."}),e.jsx("div",{className:"space-y-2 mb-4",children:K.map(b=>e.jsxs("label",{className:"flex items-center gap-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"reason",value:b,checked:p===b,onChange:I=>o(I.target.value),className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-gray-700",children:b})]},b))}),p==="××—×¨"&&e.jsx("textarea",{value:j,onChange:b=>F(b.target.value),placeholder:"×¤×¨×˜ ××ª ×”×¡×™×‘×”...",className:"w-full p-3 border rounded-lg mb-4 focus:ring-2 focus:ring-purple-500 outline-none",rows:2}),e.jsxs("div",{className:"flex flex-col gap-3 mt-6",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:E,disabled:!p||p==="××—×¨"&&!j,className:"flex-1 btn-primary",children:"×©×œ×— ×¤×™×“×‘×§"}),e.jsx("button",{onClick:r,className:"flex-1 btn-secondary",children:"×‘×™×˜×•×œ"})]}),e.jsxs("button",{onClick:C,disabled:!p||p==="××—×¨"&&!j,className:"w-full bg-purple-100 text-purple-700 hover:bg-purple-200 font-medium py-2 px-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[e.jsx(ce,{size:18}),"×©×œ×— ×¤×™×“×‘×§ ×•×¢×¨×•×š ×©×™×‘×•×¥"]})]})]})})},Qs=({onClose:r,onExport:k})=>{const[d,p]=x.useState(1),[o,j]=x.useState("image");return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[80] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full p-6",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6 flex items-center gap-2",children:[e.jsx(X,{className:"w-6 h-6 text-blue-600"}),"×™×™×¦×•× ×©×™×‘×•×¥"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"×¡×•×’ ×™×™×¦×•×"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:()=>j("image"),className:`p-4 rounded-xl border-2 flex flex-col items-center gap-2 transition-all ${o==="image"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300 text-gray-600"}`,children:[e.jsx("div",{className:"bg-blue-100 p-2 rounded-full",children:e.jsx(X,{className:"w-6 h-6 text-blue-600"})}),e.jsx("span",{className:"font-bold",children:"×ª×ž×•× ×” (WhatsApp)"})]}),e.jsxs("button",{onClick:()=>j("excel"),className:`p-4 rounded-xl border-2 flex flex-col items-center gap-2 transition-all ${o==="excel"?"border-green-500 bg-green-50 text-green-700":"border-gray-200 hover:border-gray-300 text-gray-600"}`,children:[e.jsx("div",{className:"bg-green-100 p-2 rounded-full",children:e.jsx(Me,{className:"w-6 h-6 text-green-600"})}),e.jsx("span",{className:"font-bold",children:"××§×¡×œ (Sheets)"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"×ž×¡×¤×¨ ×™×ž×™× ×œ×™×™×¦×•×"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>p(Math.max(1,d-1)),className:"w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center hover:bg-gray-200",children:"-"}),e.jsx("span",{className:"text-xl font-bold w-12 text-center",children:d}),e.jsx("button",{onClick:()=>p(Math.min(14,d+1)),className:"w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center hover:bg-gray-200",children:"+"})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:o==="image"?"×”×ª×ž×•× ×” ×ª×›×™×œ ××ª ×›×œ ×”×™×ž×™× ×©× ×‘×—×¨×• ×‘×¨×¦×£.":"×§×•×‘×¥ ×”××§×¡×œ ×™×›×™×œ ××ª ×›×œ ×”×ž×©×™×ž×•×ª ×‘×˜×•×•×— ×”×™×ž×™× ×©× ×‘×—×¨."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs("button",{onClick:()=>k(o,d),className:`flex-1 btn-primary flex items-center justify-center gap-2 ${o==="excel"?"bg-green-600 hover:bg-green-700":""}`,children:[e.jsx(X,{size:20}),o==="image"?"×”×•×¨×“ ×ª×ž×•× ×”":"×”×•×¨×“ ××§×¡×œ"]}),e.jsx("button",{onClick:r,className:"flex-1 btn-secondary",children:"×‘×™×˜×•×œ"})]})]})]})})};export{it as default};
