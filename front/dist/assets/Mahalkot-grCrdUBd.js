import{c as O,j as e,r as g,X as M,Q as N,b as $,d as U,S as z,U as E,e as H,u as K}from"./index-MGr0sPC9.js";import{S as V}from"./save-JpyDqU2L.js";import{P as G,a as P}from"./plus-BHkSYOlI.js";import{C as F}from"./calendar-C4Y2KWCB.js";import{T as q}from"./trash-2-iSZ9G9z-.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=O("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=O("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),Z=a=>{if(a.status&&a.status.status_type==="ריתוק")return{text:"ריתוק",className:"bg-red-600 text-white",show:!0};if(a.in_round&&(!a.status||a.status.status_type==="בבסיס"))return{text:"סבב קו",className:"bg-green-600 text-white",show:!0};if(a.status&&a.status.status_type!=="בבסיס"){const S={"בקשת יציאה":"bg-blue-500 text-white",גימלים:"bg-yellow-500 text-white",ריתוק:"bg-red-600 text-white","בסבב קו":"bg-green-600 text-white",מיוחדת:"bg-purple-600 text-white",בקורס:"bg-indigo-600 text-white"};return{text:a.status.status_type,className:S[a.status.status_type]||"bg-gray-500 text-white",show:!0,startDate:a.status.start_date,endDate:a.status.end_date,returnDate:a.status.return_date}}return{text:"",className:"",show:!1}},J=({soldier:a,onClick:S})=>{const j=Z(a);if(!j.show)return null;let n="",u="לחץ לשינוי סטטוס";if(j.startDate&&j.endDate){const _=new Date(j.startDate),b=new Date(j.endDate);n=`${_.toLocaleDateString("he-IL",{day:"numeric",month:"numeric"})} - ${b.toLocaleDateString("he-IL",{day:"numeric",month:"numeric"})}`,u=`מ-${_.toLocaleDateString("he-IL")} עד ${b.toLocaleDateString("he-IL")}`}else if(j.endDate){const _=new Date(j.endDate);n=_.toLocaleDateString("he-IL",{day:"numeric",month:"numeric"}),u=`עד: ${_.toLocaleDateString("he-IL")}`}else if(j.returnDate){const _=new Date(j.returnDate);n=_.toLocaleDateString("he-IL",{day:"numeric",month:"numeric"}),u=`חזרה: ${_.toLocaleDateString("he-IL")}`}return e.jsxs("span",{onClick:S,className:`text-xs px-2 py-1 rounded-full cursor-pointer hover:opacity-80 transition-opacity ${j.className}`,title:u,children:[j.text,n&&e.jsxs("span",{className:"mr-1",children:["(",n,")"]})]})},W=({soldier:a,onClose:S,onUpdate:j})=>{var D,t,m,w,r;const[n,u]=g.useState({status_type:((D=a.status)==null?void 0:D.status_type)||"בבסיס",start_date:((t=a.status)==null?void 0:t.start_date)||"",end_date:((m=a.status)==null?void 0:m.end_date)||"",return_date:((w=a.status)==null?void 0:w.return_date)||"",notes:((r=a.status)==null?void 0:r.notes)||""}),[_,b]=g.useState(!1),y=[{value:"בבסיס",label:"בבסיס",needsReturn:!1},{value:"בקשת יציאה",label:"בקשת יציאה",needsReturn:!0},{value:"גימלים",label:"גימלים",needsReturn:!0},{value:"ריתוק",label:"ריתוק",needsReturn:!0},{value:"בסבב קו",label:"בסבב קו",needsReturn:!1},{value:"מיוחדת",label:"מיוחדת",needsReturn:!0},{value:"בקורס",label:"בקורס",needsReturn:!0}],h=y.find(l=>l.value===n.status_type),X=async l=>{var v,d;if(l.preventDefault(),h!=null&&h.needsReturn&&!n.end_date){N.error("חובה להזין תאריך סיום");return}if(n.start_date&&n.end_date&&n.start_date>n.end_date){N.error("תאריך התחלה חייב להיות לפני תאריך סיום");return}b(!0);try{await $.put(`/soldiers/${a.id}/status`,{status_type:n.status_type,start_date:n.start_date||null,end_date:n.end_date||null,return_date:n.return_date||n.end_date||null,notes:n.notes}),N.success("סטטוס עודכן בהצלחה"),j(),S()}catch(x){N.error(((d=(v=x.response)==null?void 0:v.data)==null?void 0:d.error)||"שגיאה בעדכון סטטוס")}finally{b(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[70] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"bg-military-600 text-white px-6 py-4 flex items-center justify-between rounded-t-xl",children:[e.jsxs("h2",{className:"text-xl font-bold",children:["שינוי סטטוס - ",a.name]}),e.jsx("button",{onClick:S,className:"text-white hover:text-gray-200",children:e.jsx(M,{size:24})})]}),e.jsxs("form",{onSubmit:X,className:"p-6 space-y-4",children:[a.in_round&&e.jsxs("div",{className:"bg-green-50 border-l-4 border-green-500 p-3 text-sm",children:[e.jsx("p",{className:"text-green-700 font-medium",children:"ℹ️ החייל כרגע בסבב קו (17-4)"}),e.jsx("p",{className:"text-green-600 text-xs mt-1",children:'אם תבחר "ריתוק", הריתוק ידרוס את הסבב והחייל יישאר בבסיס'})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"סטטוס *"}),e.jsx("select",{value:n.status_type,onChange:l=>u({...n,status_type:l.target.value,start_date:"",end_date:"",return_date:""}),className:"input-field",required:!0,children:y.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]}),(h==null?void 0:h.needsReturn)&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"label flex items-center gap-2",children:[e.jsx(F,{size:16}),"תאריך התחלה"]}),e.jsx("input",{type:"date",value:n.start_date,onChange:l=>u({...n,start_date:l.target.value}),className:"input-field",max:n.end_date||void 0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"מתי הסטטוס מתחיל (אופציונלי)"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label flex items-center gap-2",children:[e.jsx(F,{size:16}),"תאריך סיום *"]}),e.jsx("input",{type:"date",value:n.end_date,onChange:l=>u({...n,end_date:l.target.value}),className:"input-field",required:!0,min:n.start_date||new Date().toISOString().split("T")[0]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"עד תאריך זה החייל יהיה לא זמין לשיבוצים"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"הערות (אופציונלי)"}),e.jsx("textarea",{value:n.notes,onChange:l=>u({...n,notes:l.target.value}),className:"input-field",rows:"2",placeholder:"הערות נוספות..."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:_,className:"flex-1 btn-primary",children:_?"שומר...":"עדכן סטטוס"}),e.jsx("button",{type:"button",onClick:S,className:"flex-1 btn-secondary",children:"ביטול"})]})]})]})})},ee=({plugaId:a,onClose:S,onSave:j})=>{const[n,u]=g.useState({number:"",color:"#"+Math.floor(Math.random()*16777215).toString(16),is_special:!1}),[_,b]=g.useState(!1),[y,h]=g.useState(null),[X,D]=g.useState(!1),[t,m]=g.useState({mm:{name:"",date:"",role:"ממ",certifications:[]},samal:{name:"",date:"",role:"סמל",certifications:[]},mkXa:{name:"",date:"",role:"מכ",certifications:[]},mkXb:{name:"",date:"",role:"מכ",certifications:[]},mkXg:{name:"",date:"",role:"מכ",certifications:[]},kitaA:{soldiers:[{name:"",certifications:[]}],date:""},kitaB:{soldiers:[{name:"",certifications:[]}],date:""},kitaG:{soldiers:[{name:"",certifications:[]}],date:""}}),[w,r]=g.useState(!1),[l,v]=g.useState(!1),[d,x]=g.useState(""),[C,p]=g.useState([]);g.useEffect(()=>{(async()=>{try{const o=await $.get("/available-roles-certifications");p(o.data.roles_certifications||[])}catch(o){console.error("Error loading certifications:",o)}})()},[]);const f=s=>["ממ","מכ","סמל"].includes(s)?C.filter(i=>i==="קצין תורן"):C.filter(i=>i==="נהג"||i==="חמל"),R=async s=>{var o,i;s.preventDefault(),b(!0);try{if(!a){N.error("ראשית צור פלוגה לפני הוספת מחלקה");return}const c=await $.post("/mahalkot",{...n,pluga_id:a}),k=c.data.mahlaka||c.data;h(k.id),N.success("המחלקה נוצרה בהצלחה"),D(!0)}catch(c){N.error(((i=(o=c.response)==null?void 0:o.data)==null?void 0:i.error)||"שגיאה ביצירת מחלקה"),b(!1)}},B=()=>{const s=[],o=n.number,i=c=>{if(!c)return"";if(/^\d{2}\.\d{2}\.\d{4}$/.test(c))return c;const k=c.match(/^(\d{4})-(\d{2})-(\d{2})$/);return k?`${k[3]}.${k[2]}.${k[1]}`:c};return t.mm.name&&s.push({name:t.mm.name,role:"ממ",unavailable_date:i(l?d:t.mm.date),mahlaka_id:y,certifications:t.mm.certifications||[]}),t.samal.name&&s.push({name:t.samal.name,role:"סמל",unavailable_date:i(l?d:t.samal.date),mahlaka_id:y,certifications:t.samal.certifications||[]}),t.mkXa.name&&s.push({name:t.mkXa.name,role:"מכ",kita:`${o}א`,unavailable_date:i(l?d:t.mkXa.date),mahlaka_id:y,certifications:t.mkXa.certifications||[]}),t.mkXb.name&&s.push({name:t.mkXb.name,role:"מכ",kita:`${o}ב`,unavailable_date:i(l?d:t.mkXb.date),mahlaka_id:y,certifications:t.mkXb.certifications||[]}),t.mkXg.name&&s.push({name:t.mkXg.name,role:"מכ",kita:`${o}ג`,unavailable_date:i(l?d:t.mkXg.date),mahlaka_id:y,certifications:t.mkXg.certifications||[]}),t.kitaA.soldiers.forEach(c=>{c.name&&s.push({name:c.name,role:"לוחם",kita:`${o}א`,unavailable_date:i(l?d:t.kitaA.date),mahlaka_id:y,certifications:c.certifications||[]})}),t.kitaB.soldiers.forEach(c=>{c.name&&s.push({name:c.name,role:"לוחם",kita:`${o}ב`,unavailable_date:i(l?d:t.kitaB.date),mahlaka_id:y,certifications:c.certifications||[]})}),t.kitaG.soldiers.forEach(c=>{c.name&&s.push({name:c.name,role:"לוחם",kita:`${o}ג`,unavailable_date:i(l?d:t.kitaG.date),mahlaka_id:y,certifications:c.certifications||[]})}),s},I=async s=>{var i,c;s.preventDefault();const o=B();if(o.length===0){N.warning('אנא הוסף לפחות חייל אחד או סמל/מ"מ"');return}r(!0);try{const k=await $.post("/soldiers/bulk",{mahlaka_id:y,soldiers:o});k.data.success_count>0&&N.success(`${k.data.success_count} חיילים הוספו בהצלחה`),k.data.errors&&k.data.errors.length>0&&(k.data.errors.slice(0,5).forEach(A=>N.warning(A)),k.data.errors.length>5&&N.info(`ועוד ${k.data.errors.length-5} שגיאות נוספות`)),setTimeout(()=>{h(null),D(!1),m({mm:{name:"",date:"",role:"ממ",certifications:[]},samal:{name:"",date:"",role:"סמל",certifications:[]},mkXa:{name:"",date:"",role:"מכ",certifications:[]},mkXb:{name:"",date:"",role:"מכ",certifications:[]},mkXg:{name:"",date:"",role:"מכ",certifications:[]},kitaA:{soldiers:[{name:"",certifications:[]}],date:""},kitaB:{soldiers:[{name:"",certifications:[]}],date:""},kitaG:{soldiers:[{name:"",certifications:[]}],date:""}}),j()},1e3)}catch(k){N.error(((c=(i=k.response)==null?void 0:i.data)==null?void 0:c.error)||"שגיאה בהוספת חיילים")}finally{r(!1)}},T=()=>{h(null),D(!1),m({mm:{name:"",date:"",role:"ממ",certifications:[]},samal:{name:"",date:"",role:"סמל",certifications:[]},mkXa:{name:"",date:"",role:"מכ",certifications:[]},mkXb:{name:"",date:"",role:"מכ",certifications:[]},mkXg:{name:"",date:"",role:"מכ",certifications:[]},kitaA:{soldiers:[{name:"",certifications:[]}],date:""},kitaB:{soldiers:[{name:"",certifications:[]}],date:""},kitaG:{soldiers:[{name:"",certifications:[]}],date:""}}),j()};return X?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-4xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4",children:["ניהול מחלקה ",n.number]}),e.jsxs("form",{onSubmit:I,className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:s=>v(s.target.checked)}),e.jsx("span",{children:"כולם יוצאים באותו תאריך"})]}),l&&e.jsx("input",{type:"date",value:d,onChange:s=>x(s.target.value),className:"input-field w-48"})]}),e.jsxs("div",{className:"border-l-4 border-military-600 pl-4",children:[e.jsx("h3",{className:"font-bold text-lg mb-3",children:'מ"מ (מפקד מחלקה)'}),e.jsxs("div",{className:l?"grid grid-cols-1 gap-3":"grid grid-cols-2 gap-3",children:[e.jsx("input",{type:"text",placeholder:'שם מ"מ',value:t.mm.name,onChange:s=>m({...t,mm:{...t.mm,name:s.target.value}}),className:"input-field"}),!l&&e.jsx("input",{type:"date",value:t.mm.date,onChange:s=>m({...t,mm:{...t.mm,date:s.target.value}}),className:"input-field"})]}),t.mm.name&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"הסמכות (Ctrl לבחירה מרובה)"}),e.jsx("select",{multiple:!0,value:t.mm.certifications||[],onChange:s=>{const o=Array.from(s.target.selectedOptions,i=>i.value);m({...t,mm:{...t.mm,certifications:o}})},className:"input-field w-full h-20",children:f("ממ").map(s=>e.jsx("option",{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"border-l-4 border-blue-600 pl-4",children:[e.jsx("h3",{className:"font-bold text-lg mb-3",children:"סמל"}),e.jsxs("div",{className:l?"grid grid-cols-1 gap-3":"grid grid-cols-2 gap-3",children:[e.jsx("input",{type:"text",placeholder:"שם סמל",value:t.samal.name,onChange:s=>m({...t,samal:{...t.samal,name:s.target.value}}),className:"input-field"}),!l&&e.jsx("input",{type:"date",value:t.samal.date,onChange:s=>m({...t,samal:{...t.samal,date:s.target.value}}),className:"input-field"})]}),t.samal.name&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"הסמכות (Ctrl לבחירה מרובה)"}),e.jsx("select",{multiple:!0,value:t.samal.certifications||[],onChange:s=>{const o=Array.from(s.target.selectedOptions,i=>i.value);m({...t,samal:{...t.samal,certifications:o}})},className:"input-field w-full h-20",children:f("סמל").map(s=>e.jsx("option",{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"border-l-4 border-green-600 pl-4",children:[e.jsx("h3",{className:"font-bold text-lg mb-3",children:'מ"כ (מפקדי כיתה)'}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:l?"grid grid-cols-1 gap-3":"grid grid-cols-2 gap-3",children:[e.jsx("input",{type:"text",placeholder:`שם מ"כ כיתה ${n.number}א`,value:t.mkXa.name,onChange:s=>m({...t,mkXa:{...t.mkXa,name:s.target.value}}),className:"input-field"}),!l&&e.jsx("input",{type:"date",value:t.mkXa.date,onChange:s=>m({...t,mkXa:{...t.mkXa,date:s.target.value}}),className:"input-field"})]}),t.mkXa.name&&e.jsx("div",{className:"mt-2",children:e.jsx("select",{multiple:!0,value:t.mkXa.certifications||[],onChange:s=>{const o=Array.from(s.target.selectedOptions,i=>i.value);m({...t,mkXa:{...t.mkXa,certifications:o}})},className:"input-field w-full h-16 text-sm",title:"הסמכות (Ctrl)",children:f("מכ").map(s=>e.jsx("option",{value:s,children:s},s))})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:l?"grid grid-cols-1 gap-3":"grid grid-cols-2 gap-3",children:[e.jsx("input",{type:"text",placeholder:`שם מ"כ כיתה ${n.number}ב`,value:t.mkXb.name,onChange:s=>m({...t,mkXb:{...t.mkXb,name:s.target.value}}),className:"input-field"}),!l&&e.jsx("input",{type:"date",value:t.mkXb.date,onChange:s=>m({...t,mkXb:{...t.mkXb,date:s.target.value}}),className:"input-field"})]}),t.mkXb.name&&e.jsx("div",{className:"mt-2",children:e.jsx("select",{multiple:!0,value:t.mkXb.certifications||[],onChange:s=>{const o=Array.from(s.target.selectedOptions,i=>i.value);m({...t,mkXb:{...t.mkXb,certifications:o}})},className:"input-field w-full h-16 text-sm",title:"הסמכות (Ctrl)",children:f("מכ").map(s=>e.jsx("option",{value:s,children:s},s))})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:l?"grid grid-cols-1 gap-3":"grid grid-cols-2 gap-3",children:[e.jsx("input",{type:"text",placeholder:`שם מ"כ כיתה ${n.number}ג`,value:t.mkXg.name,onChange:s=>m({...t,mkXg:{...t.mkXg,name:s.target.value}}),className:"input-field"}),!l&&e.jsx("input",{type:"date",value:t.mkXg.date,onChange:s=>m({...t,mkXg:{...t.mkXg,date:s.target.value}}),className:"input-field"})]}),t.mkXg.name&&e.jsx("div",{className:"mt-2",children:e.jsx("select",{multiple:!0,value:t.mkXg.certifications||[],onChange:s=>{const o=Array.from(s.target.selectedOptions,i=>i.value);m({...t,mkXg:{...t.mkXg,certifications:o}})},className:"input-field w-full h-16 text-sm",title:"הסמכות (Ctrl)",children:f("מכ").map(s=>e.jsx("option",{value:s,children:s},s))})})]})]})]}),e.jsxs("div",{className:"border-l-4 border-orange-600 pl-4",children:[e.jsxs("h3",{className:"font-bold text-lg mb-3",children:["חיילים כיתה ",n.number,"א"]}),!l&&e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"date",value:t.kitaA.date,onChange:s=>m({...t,kitaA:{...t.kitaA,date:s.target.value}}),className:"input-field w-full",placeholder:"תאריך יציאה"})}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:t.kitaA.soldiers.map((s,o)=>e.jsxs("div",{className:"flex gap-2 items-start",children:[e.jsx("input",{type:"text",placeholder:"שם חייל",value:s.name,onChange:i=>{const c=[...t.kitaA.soldiers];c[o].name=i.target.value,o===c.length-1&&i.target.value.trim()&&c.push({name:"",certifications:[]}),m({...t,kitaA:{...t.kitaA,soldiers:c}})},onKeyDown:i=>{if(i.key==="Backspace"&&s.name===""&&t.kitaA.soldiers.length>1){i.preventDefault();const c=t.kitaA.soldiers.filter((k,A)=>A!==o);m({...t,kitaA:{...t.kitaA,soldiers:c}})}},className:"input-field flex-1"}),e.jsx("select",{multiple:!0,value:s.certifications||[],onChange:i=>{const c=[...t.kitaA.soldiers],k=Array.from(i.target.selectedOptions,A=>A.value);c[o].certifications=k,m({...t,kitaA:{...t.kitaA,soldiers:c}})},className:"input-field w-32 h-10",title:"הסמכות (Ctrl לבחירה מרובה)",children:f("לוחם").map(i=>e.jsx("option",{value:i,children:i},i))})]},o))})]}),e.jsxs("div",{className:"border-l-4 border-purple-600 pl-4",children:[e.jsxs("h3",{className:"font-bold text-lg mb-3",children:["חיילים כיתה ",n.number,"ב"]}),!l&&e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"date",value:t.kitaB.date,onChange:s=>m({...t,kitaB:{...t.kitaB,date:s.target.value}}),className:"input-field w-full",placeholder:"תאריך יציאה"})}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:t.kitaB.soldiers.map((s,o)=>e.jsxs("div",{className:"flex gap-2 items-start",children:[e.jsx("input",{type:"text",placeholder:"שם חייל",value:s.name,onChange:i=>{const c=[...t.kitaB.soldiers];c[o].name=i.target.value,o===c.length-1&&i.target.value.trim()&&c.push({name:"",certifications:[]}),m({...t,kitaB:{...t.kitaB,soldiers:c}})},onKeyDown:i=>{if(i.key==="Backspace"&&s.name===""&&t.kitaB.soldiers.length>1){i.preventDefault();const c=t.kitaB.soldiers.filter((k,A)=>A!==o);m({...t,kitaB:{...t.kitaB,soldiers:c}})}},className:"input-field flex-1"}),e.jsx("select",{multiple:!0,value:s.certifications||[],onChange:i=>{const c=[...t.kitaB.soldiers],k=Array.from(i.target.selectedOptions,A=>A.value);c[o].certifications=k,m({...t,kitaB:{...t.kitaB,soldiers:c}})},className:"input-field w-32 h-10",title:"הסמכות (Ctrl לבחירה מרובה)",children:f("לוחם").map(i=>e.jsx("option",{value:i,children:i},i))})]},o))})]}),e.jsxs("div",{className:"border-l-4 border-pink-600 pl-4",children:[e.jsxs("h3",{className:"font-bold text-lg mb-3",children:["חיילים כיתה ",n.number,"ג"]}),!l&&e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"date",value:t.kitaG.date,onChange:s=>m({...t,kitaG:{...t.kitaG,date:s.target.value}}),className:"input-field w-full",placeholder:"תאריך יציאה"})}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:t.kitaG.soldiers.map((s,o)=>e.jsxs("div",{className:"flex gap-2 items-start",children:[e.jsx("input",{type:"text",placeholder:"שם חייל",value:s.name,onChange:i=>{const c=[...t.kitaG.soldiers];c[o].name=i.target.value,o===c.length-1&&i.target.value.trim()&&c.push({name:"",certifications:[]}),m({...t,kitaG:{...t.kitaG,soldiers:c}})},onKeyDown:i=>{if(i.key==="Backspace"&&s.name===""&&t.kitaG.soldiers.length>1){i.preventDefault();const c=t.kitaG.soldiers.filter((k,A)=>A!==o);m({...t,kitaG:{...t.kitaG,soldiers:c}})}},className:"input-field flex-1"}),e.jsx("select",{multiple:!0,value:s.certifications||[],onChange:i=>{const c=[...t.kitaG.soldiers],k=Array.from(i.target.selectedOptions,A=>A.value);c[o].certifications=k,m({...t,kitaG:{...t.kitaG,soldiers:c}})},className:"input-field w-32 h-10",title:"הסמכות (Ctrl לבחירה מרובה)",children:f("לוחם").map(i=>e.jsx("option",{value:i,children:i},i))})]},o))})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:w,className:"flex-1 btn-primary",children:w?"שומר...":"שמור מחלקה עם חיילים"}),e.jsx("button",{type:"button",onClick:T,className:"flex-1 btn-secondary",children:"דלג (יצירת מחלקה בלבד)"})]})]})]})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"הוספת מחלקה חדשה"}),e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"מספר מחלקה"}),e.jsx("input",{type:"number",value:n.number,onChange:s=>u({...n,number:parseInt(s.target.value)}),className:"input-field",required:!0,min:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"צבע"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"color",value:n.color,onChange:s=>u({...n,color:s.target.value}),className:"w-16 h-10 rounded cursor-pointer"}),e.jsx("input",{type:"text",value:n.color,onChange:s=>u({...n,color:s.target.value}),className:"input-field flex-1"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.is_special,onChange:s=>u({...n,is_special:s.target.checked}),className:"w-4 h-4 text-military-600"}),e.jsx("span",{className:"text-gray-700 font-medium",children:"מחלקה מיוחדת"})]}),e.jsx("p",{className:"text-xs text-gray-500 mr-6",children:"מחלקה זו תוכל לבצע משימות המוגדרות כדורשות מחלקה מיוחדת"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",disabled:_,className:"flex-1 btn-primary",children:_?"יוצר...":"צור מחלקה"}),e.jsx("button",{type:"button",onClick:S,className:"flex-1 btn-secondary",children:"ביטול"})]})]})]})})},te=({soldier:a,mahlakaId:S,onClose:j,onSave:n})=>{const[u,_]=g.useState({name:"",role:"לוחם",kita:"",idf_id:"",personal_id:"",phone_number:"",address:"",emergency_contact_name:"",emergency_contact_number:"",pakal:"",has_hatashab:!1,recruit_date:"",birth_date:"",home_round_date:"",certifications:[]}),[b,y]=g.useState(!1);g.useEffect(()=>{a&&_({name:a.name||"",role:a.role||"לוחם",kita:a.kita||"",idf_id:a.idf_id||"",personal_id:a.personal_id||"",phone_number:a.phone_number||"",address:a.address||"",emergency_contact_name:a.emergency_contact_name||"",emergency_contact_number:a.emergency_contact_number||"",pakal:a.pakal||"",has_hatashab:a.has_hatashab||!1,recruit_date:a.recruit_date||"",birth_date:a.birth_date||"",home_round_date:a.home_round_date||"",certifications:a.certifications?a.certifications.map(t=>t.name):[]})},[a]);const h=t=>{const{name:m,value:w,type:r,checked:l}=t.target;_(v=>({...v,[m]:r==="checkbox"?l:w}))},X=async t=>{var m,w;t.preventDefault(),y(!0);try{const r={...u,mahlaka_id:S};a?(await $.put(`/soldiers/${a.id}`,r),N.success("פרטי חייל עודכנו בהצלחה")):(await $.post("/soldiers",r),N.success("חייל נוסף בהצלחה")),n()}catch(r){console.error("Error saving soldier:",r),N.error(((w=(m=r.response)==null?void 0:m.data)==null?void 0:w.error)||"שגיאה בשמירת פרטי חייל")}finally{y(!1)}},D=["לוחם","ממ","מכ","סמל","חופל","קשר","נהג","אחר"];return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex items-center justify-between z-10",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:a?"עריכת פרטי חייל":"הוספת חייל חדש"}),e.jsx("button",{onClick:j,className:"text-gray-500 hover:text-gray-700",children:e.jsx(M,{size:24})})]}),e.jsxs("form",{onSubmit:X,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"שם מלא"}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",name:"name",value:u.name,onChange:h,required:!0,className:"input-field pr-10 w-full",placeholder:"ישראל ישראלי"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"תפקיד"}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("select",{name:"role",value:u.role,onChange:h,className:"input-field pr-10 w-full",children:D.map(t=>e.jsx("option",{value:t,children:t},t))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"מספר אישי"}),e.jsx("input",{type:"text",name:"personal_id",value:u.personal_id,onChange:h,className:"input-field w-full",dir:"ltr",placeholder:"1234567"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"כיתה"}),e.jsx("input",{type:"text",name:"kita",value:u.kita,onChange:h,className:"input-field w-full",placeholder:"שם כיתה"})]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"טלפון"}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"tel",name:"phone_number",value:u.phone_number,onChange:h,className:"input-field pr-10 w-full",dir:"ltr"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"כתובת"}),e.jsxs("div",{className:"relative",children:[e.jsx(Q,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{type:"text",name:"address",value:u.address,onChange:h,className:"input-field pr-10 w-full"})]})]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"תאריך גיוס"}),e.jsx("input",{type:"date",name:"recruit_date",value:u.recruit_date,onChange:h,className:"input-field w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"תאריך לידה"}),e.jsx("input",{type:"date",name:"birth_date",value:u.birth_date,onChange:h,className:"input-field w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"תאריך סבב יציאה"}),e.jsx("input",{type:"date",name:"home_round_date",value:u.home_round_date,onChange:h,className:"input-field w-full"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",name:"has_hatashab",id:"has_hatashab",checked:u.has_hatashab,onChange:h,className:"rounded text-military-600 focus:ring-military-500 h-4 w-4"}),e.jsx("label",{htmlFor:"has_hatashab",className:"text-sm font-medium text-gray-700",children:'זכאי התש"ב (יציאות מיוחדות)'})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:j,className:"btn-secondary",disabled:b,children:"ביטול"}),e.jsxs("button",{type:"submit",className:"btn-primary flex items-center gap-2",disabled:b,children:[e.jsx(V,{size:18}),b?"שומר...":"שמור שינויים"]})]})]})]})})},L=21,ae=({soldier:a,onClose:S,onEdit:j})=>{const[n,u]=g.useState([]),[_,b]=g.useState(!1),[y,h]=g.useState((a.certifications||[]).map(r=>typeof r=="string"?{id:null,name:r}:r));g.useEffect(()=>{(async()=>{try{const l=await $.get("/available-roles-certifications");u(l.data.roles_certifications||[])}catch(l){console.error("Error loading available roles:",l),u(["נהג","חמל","קצין תורן"])}})()},[]);const X=()=>["ממ","מכ","סמל"].includes(a.role)?n.filter(l=>l==="קצין תורן"):n.filter(l=>l==="נהג"||l==="חמל"),D=async r=>{var l,v;try{const x=(await $.post(`/soldiers/${a.id}/certifications`,{certification_name:r})).data.certification;h([...y,{id:x.id,name:x.name}]),N.success(`הסמכת "${r}" נוספה בהצלחה`),b(!1)}catch(d){N.error(((v=(l=d.response)==null?void 0:l.data)==null?void 0:v.error)||"שגיאה בהוספת הסמכה")}},t=async r=>{var l,v;if(!r.id){N.error("לא ניתן למחוק הסמכה זו");return}if(window.confirm(`האם למחוק את הסמכת "${r.name}"?`))try{await $.delete(`/certifications/${r.id}`),h(y.filter(d=>d.id!==r.id)),N.success("ההסמכה נמחקה בהצלחה")}catch(d){N.error(((v=(l=d.response)==null?void 0:l.data)==null?void 0:v.error)||"שגיאה במחיקת הסמכה")}},w=(()=>{if(!a.home_round_date)return null;const r=new Date(a.home_round_date),l=new Date;l.setHours(0,0,0,0),r.setHours(0,0,0,0);const v=l.getTime()-r.getTime(),d=Math.floor(v/(1e3*60*60*24)),x=Math.floor(d/L),C=(d%L+L)%L,p=new Date(r);return p.setDate(p.getDate()+(x+1)*L),{roundNumber:x+1,daysIntoRound:C,nextRoundDate:p.toLocaleDateString("he-IL"),daysUntilNextRound:L-C}})();return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-military-600 to-military-700 text-white px-6 py-4 flex items-center justify-between rounded-t-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(z,{size:28}),e.jsx("h2",{className:"text-2xl font-bold",children:a.name})]}),e.jsx("button",{onClick:S,className:"text-white hover:text-gray-200",children:e.jsx(M,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-gray-500 uppercase",children:"תפקיד"}),e.jsx("p",{className:"font-medium text-gray-900",children:a.role})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-gray-500 uppercase",children:"כיתה"}),e.jsx("p",{className:"font-medium text-gray-900",children:a.kita||"אין כיתה"})]})]}),(a.idf_id||a.personal_id)&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t",children:[a.idf_id&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-gray-500 uppercase",children:"מספר אישי"}),e.jsx("p",{className:"font-medium text-gray-900",children:a.idf_id})]}),a.personal_id&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-gray-500 uppercase",children:"תעודת זהות"}),e.jsx("p",{className:"font-medium text-gray-900",children:a.personal_id})]})]}),(a.phone_number||a.address)&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t",children:[a.phone_number&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-xs text-gray-500 uppercase flex items-center gap-1",children:[e.jsx(E,{size:14}),"טלפון"]}),e.jsx("p",{className:"font-medium text-gray-900",children:a.phone_number})]}),a.address&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-xs text-gray-500 uppercase flex items-center gap-1",children:[e.jsx(z,{size:14}),"כתובת"]}),e.jsx("p",{className:"font-medium text-gray-900",children:a.address})]})]}),(a.emergency_contact_name||a.emergency_contact_number)&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-3",children:"איש קשר לחירום"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.emergency_contact_name&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-gray-500 uppercase",children:"שם"}),e.jsx("p",{className:"font-medium text-gray-900",children:a.emergency_contact_name})]}),a.emergency_contact_number&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-gray-500 uppercase",children:"טלפון"}),e.jsx("p",{className:"font-medium text-gray-900",children:a.emergency_contact_number})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t",children:[a.pakal&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-gray-500 uppercase",children:"פק״ל"}),e.jsx("p",{className:"font-medium text-gray-900",children:a.pakal})]}),a.recruit_date&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-gray-500 uppercase",children:"תאריך גיוס"}),e.jsx("p",{className:"font-medium text-gray-900",children:new Date(a.recruit_date).toLocaleDateString("he-IL")})]}),a.birth_date&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-gray-500 uppercase",children:"תאריך לידה"}),e.jsx("p",{className:"font-medium text-gray-900",children:new Date(a.birth_date).toLocaleDateString("he-IL")})]})]}),w&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("h3",{className:"font-bold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(z,{size:20,className:"text-military-600"}),"סבב יציאה נוכחי"]}),e.jsxs("div",{className:"bg-military-50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-700",children:"סבב מספר:"}),e.jsx("span",{className:"font-bold text-military-700",children:w.roundNumber})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-700",children:"יום בסבב:"}),e.jsxs("span",{className:"font-bold text-military-700",children:[w.daysIntoRound+1," מתוך ",L]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-700",children:"ימים עד סבב הבא:"}),e.jsx("span",{className:"font-bold text-military-700",children:w.daysUntilNextRound})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-military-200",children:[e.jsx("span",{className:"text-gray-700",children:"תאריך סבב הבא:"}),e.jsx("span",{className:"font-bold text-military-700",children:w.nextRoundDate})]})]})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(z,{size:20,className:"text-military-600"}),"הסמכות (",y.length,")"]}),e.jsxs("button",{onClick:()=>b(!0),className:"btn-primary text-sm px-3 py-1 flex items-center gap-1",children:[e.jsx(G,{size:16}),"הוסף הסמכה"]})]}),y.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:y.map((r,l)=>{const v=["ממ","מכ","סמל"],d=r.name==="מפקד"&&v.includes(a.role);return e.jsxs("span",{className:`badge ${d?"badge-green":"badge-blue"} flex items-center gap-2 group`,title:d?"הסמכה אוטומטית למפקדים":"",children:[r.name,d&&e.jsx("span",{className:"text-xs",children:"(אוטומטי)"}),!d&&e.jsx("button",{onClick:()=>t(r),className:"opacity-0 group-hover:opacity-100 hover:text-red-600 transition-opacity",title:"מחק הסמכה",disabled:!r.id,children:e.jsx(M,{size:14})})]},r.id||`cert-${l}-${r.name}`)})}):e.jsx("p",{className:"text-gray-500 text-sm",children:"אין הסמכות"})]}),a.has_hatashab&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-3",children:"סטטוס"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsx("span",{className:"badge badge-yellow",children:"התש״ב"})})]}),(()=>{var v;const r=new Date;r.setHours(0,0,0,0);const l=((v=a.unavailable_dates)==null?void 0:v.filter(d=>{const x=d.end_date?new Date(d.end_date):new Date(d.date);return x.setHours(23,59,59,999),x>=r}))||[];return l.length>0&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-3",children:"תאריכי חופשה / אי זמינות קרובים"}),e.jsx("div",{className:"space-y-2",children:l.map(d=>e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsxs("span",{className:`badge ${d.unavailability_type==="גימל"?"badge-yellow":d.unavailability_type==="בקשת יציאה"?"badge-blue":"badge-gray"}`,children:[d.unavailability_type||"חופשה",d.quantity&&` (${d.quantity})`]})}),e.jsxs("div",{className:"font-medium text-gray-900",children:[new Date(d.date).toLocaleDateString("he-IL"),d.end_date&&e.jsxs("span",{children:[" - ",new Date(d.end_date).toLocaleDateString("he-IL")]})]}),d.reason&&e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:d.reason})]},d.id))})]})})()]}),e.jsxs("div",{className:"sticky bottom-0 bg-gray-50 px-6 py-4 flex justify-between items-center rounded-b-xl border-t",children:[e.jsxs("button",{onClick:j,className:"btn-primary flex items-center gap-2",children:[e.jsx(P,{size:20}),e.jsx("span",{children:"ערוך"})]}),e.jsx("button",{onClick:S,className:"btn-secondary",children:"סגור"})]})]}),_&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[70]",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"הוסף הסמכה"}),e.jsx("button",{onClick:()=>b(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(M,{size:24})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["בחר הסמכה להוספה עבור ",a.name]}),X().filter(r=>!y.some(l=>l.name===r)).map(r=>e.jsx("button",{onClick:()=>D(r),className:"w-full text-right p-3 border-2 border-gray-200 rounded-lg hover:border-military-600 hover:bg-military-50 transition-colors",children:r},r)),X().filter(r=>!y.some(l=>l.name===r)).length===0&&e.jsx("p",{className:"text-center text-gray-500 py-4",children:"כל ההסמכות כבר נוספו"})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:()=>b(!1),className:"btn-secondary",children:"ביטול"})})]})})]})},se=({mahlaka:a,soldiers:S,onClose:j,onDelete:n,onRefresh:u})=>{const[_,b]=g.useState(null),[y,h]=g.useState(!1),[X,D]=g.useState(!1),[t,m]=g.useState(null),[w,r]=g.useState(!1),[l,v]=g.useState(null),d=[...S].sort((p,f)=>{const R={ממ:1,סמל:2,מכ:3,חייל:4},B=R[p.role]||99,I=R[f.role]||99;return B!==I?B-I:p.kita!==f.kita?p.kita?f.kita?p.kita.localeCompare(f.kita):-1:1:p.name.localeCompare(f.name)}),x=p=>({לוחם:"badge-green",'מ"מ':"badge-purple",'מ"כ':"badge-purple",סמל:"badge-yellow"})[p]||"badge-blue",C=async p=>{try{const f=await $.get(`/soldiers/${p.id}`);m(f.data.soldier),D(!0)}catch(f){N.error("שגיאה בטעינת פרטי חייל"),console.error(f)}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-military-600 to-military-700 text-white px-6 py-4 flex items-center justify-between rounded-t-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(z,{size:28,style:{color:a.color}}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold",children:["מחלקה ",a.number]}),e.jsxs("p",{className:"text-military-100",children:[S.length," חיילים"]})]})]}),e.jsx("button",{onClick:j,className:"text-white hover:text-gray-200",children:e.jsx(M,{size:24})})]}),e.jsx("div",{className:"p-6",children:S.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(E,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{children:"אין חיילים במחלקה זו"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"שם"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"תפקיד"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"כיתה"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"פעולות"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:d.map(p=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap cursor-pointer",onClick:()=>C(p),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-military-100 p-2 rounded-full",children:e.jsx(z,{size:16,className:"text-military-600"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-medium text-gray-900 hover:text-military-600 transition-colors",children:p.name}),e.jsx(J,{soldier:p,onClick:f=>{f.stopPropagation(),v(p),r(!0)}})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`badge ${x(p.role)}`,children:p.role})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:p.kita||"אין כיתה"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:f=>{f.stopPropagation(),v(p),r(!0)},className:"text-green-600 hover:text-green-800",title:"שינוי סטטוס",children:e.jsx(H,{size:18})}),e.jsx("button",{onClick:()=>{b(p),h(!0)},className:"text-blue-600 hover:text-blue-800",title:"ערוך",children:e.jsx(P,{size:18})}),e.jsx("button",{onClick:()=>n(p.id),className:"text-red-600 hover:text-red-800",title:"מחק",children:e.jsx(q,{size:18})})]})})]},p.id))})]})})}),e.jsxs("div",{className:"sticky bottom-0 bg-gray-50 px-6 py-4 flex justify-between items-center rounded-b-xl border-t",children:[e.jsxs("button",{onClick:()=>{b(null),h(!0)},className:"btn-primary flex items-center gap-2",children:[e.jsx(G,{size:20}),e.jsx("span",{children:"הוסף חייל"})]}),e.jsx("button",{onClick:j,className:"btn-secondary",children:"סגור"})]})]})}),y&&e.jsx(te,{soldier:_,mahlakaId:a.id,onClose:()=>{h(!1),b(null)},onSave:()=>{h(!1),b(null),u()}}),X&&t&&e.jsx(ae,{soldier:t,onClose:()=>{D(!1),m(null)},onEdit:()=>{b(t),D(!1),h(!0)}}),w&&l&&e.jsx(W,{soldier:l,onClose:()=>{r(!1),v(null)},onUpdate:()=>{u(),r(!1),v(null)}})]})},de=()=>{const{user:a}=K(),[S,j]=g.useState([]),[n,u]=g.useState(!0),[_,b]=g.useState(!1),[y,h]=g.useState(!1),[X,D]=g.useState(null),[t,m]=g.useState([]);g.useEffect(()=>{w()},[a==null?void 0:a.pluga_id]);const w=async()=>{try{if(!(a!=null&&a.pluga_id)){j([]),u(!1);return}const x=await $.get(`/plugot/${a.pluga_id}/mahalkot`);j(x.data.mahalkot||[]),u(!1)}catch(x){console.error("Error loading mahalkot:",x),N.error("שגיאה בטעינת מחלקות"),u(!1)}},r=async x=>{var C,p;if(window.confirm("בטוח שברצונך למחוק את המחלקה? פעולה זו תמחק גם את כל החיילים שבתוכה."))try{await $.delete(`/mahalkot/${x}`),N.success("המחלקה נמחקה"),w()}catch(f){console.error("Delete mahlaka error",f),N.error(((p=(C=f.response)==null?void 0:C.data)==null?void 0:p.error)||"שגיאה במחיקת המחלקה")}},l=async x=>{try{const C=await $.get(`/mahalkot/${x}/soldiers`);m(C.data.soldiers||[])}catch(C){console.error("Error loading soldiers:",C),N.error("שגיאה בטעינת חיילים")}},v=async x=>{D(x),await l(x.id),h(!0)},d=async x=>{var C,p;if(window.confirm("בטוח שברצונך למחוק את החייל?"))try{await $.delete(`/soldiers/${x}`),N.success("החייל נמחק בהצלחה"),await l(X.id),w()}catch(f){N.error(((p=(C=f.response)==null?void 0:C.data)==null?void 0:p.error)||"שגיאה במחיקת חייל")}};return n?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"spinner"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"מחלקות"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[S.length," מחלקות"]})]}),a.role==="מפ"&&e.jsxs("button",{onClick:()=>b(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(G,{size:20}),e.jsx("span",{children:"הוסף מחלקה"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:S.map(x=>e.jsxs("div",{className:"card hover:shadow-lg transition-shadow cursor-pointer",style:{borderTop:`4px solid ${x.color}`},onClick:()=>v(x),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"bg-gray-100 p-3 rounded-lg",style:{backgroundColor:`${x.color}20`},children:e.jsx(z,{className:"w-8 h-8",style:{color:x.color}})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"badge badge-blue",children:[x.soldiers_count," חיילים"]}),a.role==="מפ"&&e.jsx("button",{onClick:C=>{C.stopPropagation(),r(x.id)},className:"btn-ghost text-red-600",title:"מחק מחלקה",children:e.jsx(q,{size:18})})]})]}),e.jsxs("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:["מחלקה ",x.number]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(E,{size:16}),e.jsxs("span",{className:"text-sm",children:[x.soldiers_count," לוחמים"]})]})]},x.id))}),S.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(z,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"אין מחלקות במערכת"})]}),_&&e.jsx(ee,{plugaId:a.pluga_id,onClose:()=>b(!1),onSave:()=>{b(!1),w()}}),y&&X&&e.jsx(se,{mahlaka:X,soldiers:t,onClose:()=>{h(!1),D(null),m([])},onDelete:d,onRefresh:()=>{l(X.id),w()}})]})};export{de as default};
