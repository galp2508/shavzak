import{c as q,u as S,r as c,b as _,Q as o,j as e,F as k,X as E}from"./index-lqv-PRl0.js";import{P as I,a as T}from"./plus-O0bK9acD.js";import{T as z}from"./trash-2-Bv-2cNRL.js";import{C as w}from"./clock-DhaBFs04.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=q("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),A=()=>{const{user:s}=S(),[m,j]=c.useState([]),[N,r]=c.useState(!0),[i,x]=c.useState(!1),[y,g]=c.useState(null);c.useEffect(()=>{h()},[]);const h=async()=>{try{const n=await _.get(`/plugot/${s.pluga_id}/assignment-templates`);j(n.data.templates||[])}catch(n){console.error("Error loading templates:",n),o.error("שגיאה בטעינת תבניות"),j([])}finally{r(!1)}},d=async n=>{var u,t;if(window.confirm("האם אתה בטוח שברצונך למחוק את התבנית?"))try{await _.delete(`/assignment-templates/${n}`),o.success("התבנית נמחקה בהצלחה"),h(),window.dispatchEvent(new Event("templateChanged"))}catch(b){o.error(((t=(u=b.response)==null?void 0:u.data)==null?void 0:t.error)||"שגיאה במחיקת תבנית")}},v=async n=>{var u,t;try{await _.post(`/assignment-templates/${n}/duplicate`),o.success("התבנית שוכפלה בהצלחה"),h(),window.dispatchEvent(new Event("templateChanged"))}catch(b){o.error(((t=(u=b.response)==null?void 0:u.data)==null?void 0:t.error)||"שגיאה בשכפול תבנית")}};return N?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"spinner"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"תבניות משימות"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[m.length," תבניות"]})]}),s.role==="מפ"&&e.jsxs("button",{onClick:()=>{g(null),x(!0)},className:"btn-primary flex items-center gap-2",children:[e.jsx(I,{size:20}),e.jsx("span",{children:"תבנית חדשה"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:m.map(n=>e.jsxs("div",{className:"card hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-military-100 p-3 rounded-lg",children:e.jsx(k,{className:"w-6 h-6 text-military-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900",children:n.name}),e.jsx("p",{className:"text-sm text-gray-600",children:n.assignment_type})]})]}),s.role==="מפ"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>v(n.id),className:"text-green-600 hover:text-green-800",title:"שכפל תבנית",children:e.jsx(D,{size:18})}),e.jsx("button",{onClick:()=>{g(n),x(!0)},className:"text-blue-600 hover:text-blue-800",title:"ערוך",children:e.jsx(T,{size:18})}),e.jsx("button",{onClick:()=>d(n.id),className:"text-red-600 hover:text-red-800",title:"מחק",children:e.jsx(z,{size:18})})]})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[n.duration_days>0?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{size:16}),e.jsxs("span",{children:["משך: ",n.duration_days," ימים (כל ",n.recurrence_interval," ימים)"]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{size:16}),e.jsxs("span",{children:[n.length_in_hours," שעות × ",Math.floor(24/n.length_in_hours)," פעמים ביום"]})]}),n.start_hour!==null&&n.start_hour!==void 0&&!n.duration_days&&e.jsxs("div",{className:"text-xs text-gray-500",children:["התחלה: ",String(n.start_hour).padStart(2,"0"),":00"]}),e.jsxs("div",{className:"flex gap-2 flex-wrap mt-3",children:[n.is_base_task&&e.jsx("span",{className:"badge bg-gray-100 text-gray-700 border border-gray-300",children:"משימת בסיס"}),n.can_split&&e.jsx("span",{className:"badge bg-indigo-100 text-indigo-700 border border-indigo-300",children:"ניתן לפיצול"}),n.is_skippable&&e.jsx("span",{className:"badge bg-yellow-100 text-yellow-700 border border-yellow-300",children:"ניתן לוויתור"}),n.commanders_needed>0&&e.jsxs("span",{className:"badge badge-purple",children:[n.commanders_needed," מפקדים"]}),n.drivers_needed>0&&e.jsxs("span",{className:"badge badge-blue",children:[n.drivers_needed," נהגים"]}),n.soldiers_needed>0&&e.jsxs("span",{className:"badge badge-green",children:[n.soldiers_needed," לוחמים"]})]})]})]},n.id))}),m.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(k,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"אין תבניות משימות במערכת"})]}),i&&e.jsx(M,{template:y,plugaId:s.pluga_id,onClose:()=>{x(!1),g(null)},onSave:()=>{x(!1),g(null),h()}})]})},M=({template:s,plugaId:m,onClose:j,onSave:N})=>{const[r,i]=c.useState({name:(s==null?void 0:s.name)||"",assignment_type:(s==null?void 0:s.assignment_type)||"שמירה",length_in_hours:(s==null?void 0:s.length_in_hours)||8,start_hour:(s==null?void 0:s.start_hour)||"",commanders_needed:(s==null?void 0:s.commanders_needed)||0,drivers_needed:(s==null?void 0:s.drivers_needed)||0,soldiers_needed:(s==null?void 0:s.soldiers_needed)||1,same_mahlaka_required:(s==null?void 0:s.same_mahlaka_required)||!1,requires_certification:(s==null?void 0:s.requires_certification)||"",requires_senior_commander:(s==null?void 0:s.requires_senior_commander)||!1,reuse_soldiers_for_standby:(s==null?void 0:s.reuse_soldiers_for_standby)||!1,duration_days:(s==null?void 0:s.duration_days)||0,recurrence_interval:(s==null?void 0:s.recurrence_interval)||1,start_day_offset:(s==null?void 0:s.start_day_offset)||0,is_base_task:(s==null?void 0:s.is_base_task)||!1,can_split:(s==null?void 0:s.can_split)||!1,is_skippable:(s==null?void 0:s.is_skippable)||!1,requires_special_mahlaka:(s==null?void 0:s.requires_special_mahlaka)||!1}),[x,y]=c.useState(!1),[g,h]=c.useState([]),[d,v]=c.useState((s==null?void 0:s.duration_days)>0);c.useEffect(()=>{(async()=>{try{const l=await _.get("/available-roles-certifications");h(l.data.roles_certifications||[])}catch(l){console.error("Error loading available roles:",l),h(["נהג","חמל","קצין תורן"])}})()},[]);const n={שמירה:{length_in_hours:4,commanders_needed:0,drivers_needed:0,soldiers_needed:1,same_mahlaka_required:!1,requires_certification:""},סיור:{length_in_hours:8,commanders_needed:1,drivers_needed:1,soldiers_needed:2,same_mahlaka_required:!0,requires_certification:""},חמל:{length_in_hours:12,commanders_needed:0,drivers_needed:0,soldiers_needed:1,same_mahlaka_required:!1,requires_certification:"חמל"}},u=a=>{const l=n[a];i(l&&!s?{...r,assignment_type:a,...l}:{...r,assignment_type:a})},t=r.length_in_hours>0?Math.floor(24/r.length_in_hours):1,b=["שמירה","סיור","כוננות א","כוננות ב","חמל","תורן מטבח","חפק גשש","שלז","קצין תורן"],C=async a=>{var l,p;a.preventDefault(),y(!0);try{const f={...r,times_per_day:d?1:t,length_in_hours:d?r.duration_days*24:r.length_in_hours,duration_days:d?r.duration_days:0,start_hour:r.start_hour?parseInt(r.start_hour):null};s?(await _.put(`/assignment-templates/${s.id}`,f),o.success("התבנית עודכנה בהצלחה")):(await _.post(`/plugot/${m}/assignment-templates`,f),o.success("התבנית נוספה בהצלחה")),window.dispatchEvent(new Event("templateChanged")),N()}catch(f){o.error(((p=(l=f.response)==null?void 0:l.data)==null?void 0:p.error)||"שגיאה בשמירה")}finally{y(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex-none bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between rounded-t-xl",children:[e.jsx("h2",{className:"text-2xl font-bold",children:s?"עריכת תבנית":"תבנית משימה חדשה"}),e.jsx("button",{onClick:j,className:"text-gray-400 hover:text-gray-600",children:e.jsx(E,{size:24})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("form",{id:"templateForm",onSubmit:C,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שם התבנית *"}),e.jsx("input",{type:"text",value:r.name,onChange:a=>i({...r,name:a.target.value}),className:"input-field",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"סוג משימה *"}),e.jsx("select",{value:r.assignment_type,onChange:a=>u(a.target.value),className:"input-field",required:!0,children:b.map(a=>e.jsx("option",{value:a,children:a},a))}),n[r.assignment_type]&&!s&&e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"✓ תבנית מומלצת נטענה אוטומטית"})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mb-4",children:[e.jsx("input",{type:"checkbox",checked:d,onChange:a=>{v(a.target.checked),a.target.checked?i(l=>({...l,duration_days:1})):i(l=>({...l,duration_days:0}))},className:"w-4 h-4 text-military-600"}),e.jsx("span",{className:"font-bold text-gray-700",children:"משימה רב-יומית (נמשכת יותר מיום אחד)"})]})}),d?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"משך המשימה (ימים) *"}),e.jsx("input",{type:"number",min:"1",value:r.duration_days,onChange:a=>i({...r,duration_days:parseInt(a.target.value)}),className:"input-field",required:d})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"חזרה כל (ימים)"}),e.jsx("input",{type:"number",min:"1",value:r.recurrence_interval,onChange:a=>i({...r,recurrence_interval:parseInt(a.target.value)}),className:"input-field"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"כל כמה ימים המשימה חוזרת על עצמה (1 = רצוף)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"התחלה ביום (Offset)"}),e.jsx("input",{type:"number",min:"0",value:r.start_day_offset,onChange:a=>i({...r,start_day_offset:parseInt(a.target.value)}),className:"input-field"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"התחלה ביום ה-X של השיבוץ (0 = יום ראשון)"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"אורך במשמרת (שעות) *"}),e.jsx("input",{type:"number",min:"1",max:"24",value:r.length_in_hours,onChange:a=>i({...r,length_in_hours:parseInt(a.target.value)}),className:"input-field",required:!d}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["תקרה ",t," ",t===1?"פעם":"פעמים"," ביום (24 / ",r.length_in_hours,")"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"שעת התחלה (אופציונלי)"}),e.jsx("input",{type:"number",min:"0",max:"23",value:r.start_hour,onChange:a=>i({...r,start_hour:a.target.value}),className:"input-field",placeholder:"לדוגמה: 8"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"שעת התחלה של המשמרת הראשונה (0-23)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"מספר מפקדים נדרשים"}),e.jsx("input",{type:"number",min:"0",value:r.commanders_needed,onChange:a=>i({...r,commanders_needed:parseInt(a.target.value)}),className:"input-field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"מספר נהגים נדרשים"}),e.jsx("input",{type:"number",min:"0",value:r.drivers_needed,onChange:a=>i({...r,drivers_needed:parseInt(a.target.value)}),className:"input-field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"מספר חיילים נדרשים"}),e.jsx("input",{type:"number",min:"0",value:r.soldiers_needed,onChange:a=>i({...r,soldiers_needed:parseInt(a.target.value)}),className:"input-field"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:["הסמכה/תפקיד נדרש",e.jsx("span",{className:"text-xs text-gray-500 mr-2",children:"(תפקיד נוסף שחייל צריך בשביל המשימה)"})]}),e.jsxs("select",{value:r.requires_certification,onChange:a=>i({...r,requires_certification:a.target.value}),className:"input-field",children:[e.jsx("option",{value:"",children:"ללא הסמכה נדרשת"}),g.map(a=>e.jsx("option",{value:a,children:a},a))]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.same_mahlaka_required,onChange:a=>i({...r,same_mahlaka_required:a.target.checked}),className:"w-4 h-4 text-military-600"}),e.jsx("span",{className:"text-gray-700",children:"דורש חיילים מאותה מחלקה"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.requires_special_mahlaka,onChange:a=>i({...r,requires_special_mahlaka:a.target.checked}),className:"w-4 h-4 text-military-600"}),e.jsx("span",{className:"text-gray-700",children:"דורש מחלקה מיוחדת"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.requires_senior_commander,onChange:a=>i({...r,requires_senior_commander:a.target.checked}),className:"w-4 h-4 text-military-600"}),e.jsx("span",{className:"text-gray-700",children:"דורש מפקד בכיר"})]}),(r.assignment_type==="כוננות א"||r.assignment_type==="כוננות ב")&&e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.reuse_soldiers_for_standby,onChange:a=>i({...r,reuse_soldiers_for_standby:a.target.checked}),className:"w-4 h-4 text-military-600"}),e.jsx("span",{className:"text-gray-700",children:"קח חיילים שסיימו משימה לכוננות"}),e.jsx("span",{className:"text-xs text-gray-500",children:"(המערכת תעדיף חיילים שסיימו משימה זמן קצר לפני הכוננות)"})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-3 mt-3",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-700 mb-2",children:"הגדרות מתקדמות"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mb-2",children:[e.jsx("input",{type:"checkbox",checked:r.is_base_task,onChange:a=>i({...r,is_base_task:a.target.checked}),className:"w-4 h-4 text-green-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-700 font-medium",children:"משימת בסיס (נחשבת כמנוחה)"}),e.jsx("p",{className:"text-xs text-gray-500",children:"משימה קלה שלא דורשת שעות מנוחה לפניה/אחריה ולא שוברת רצף מנוחה"})]})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.can_split,onChange:a=>i({...r,can_split:a.target.checked}),className:"w-4 h-4 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-700 font-medium",children:"ניתן לפיצול"}),e.jsx("p",{className:"text-xs text-gray-500",children:"המערכת רשאית לפצל את המשימה לשני חלקים (למשל: פתיחה וסגירה) במידת הצורך"})]})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mt-2",children:[e.jsx("input",{type:"checkbox",checked:r.is_skippable,onChange:a=>i({...r,is_skippable:a.target.checked}),className:"w-4 h-4 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-700 font-medium",children:"ניתן לוויתור (Optional)"}),e.jsx("p",{className:"text-xs text-gray-500",children:"במקרה של חוסר בכוח אדם, המערכת תציע לוותר על משימה זו"})]})]})]})]})]})}),e.jsx("div",{className:"flex-none border-t border-gray-200 p-4 bg-gray-50 rounded-b-xl",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",form:"templateForm",disabled:x,className:"flex-1 btn-primary",children:x?"שומר...":s?"עדכן":"הוסף"}),e.jsx("button",{type:"button",onClick:j,className:"flex-1 btn-secondary",children:"ביטול"})]})})]})})};export{A as default};
